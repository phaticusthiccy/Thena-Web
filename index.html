<!DOCTYPE html>
<html lang="tr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Thena - AI Image Generator</title>
        <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAQAElEQVR4AcSaB4BXxfXvP3N/vWzvlaUudRdEBVER7P5N7BpNNGqiRo0xJi8xUSH2/9+8F1tMooma+IyJJahgxKCCRAUsCAhIh13KUraXXy/33nfm99tFRMSed3e+d+aeqefMmTNn5rdGTUGjnUGhxIUN2fQALX+8XV3QYFfnC3QsqNLpDMbZ2XSjXS3lqwvGZ+rWSjsaNRIPEtQWNdo1/agtkjKFGkLLxJLWNIHO09D1qqWfj2Oc9LMvGuS7wa4qGCdxP/Il3heSp/M1qiX9cTTYRiwSJYNwhFg4SjQSySAm9Gg0QiwSIxYVyHdMkIhGM99RTcuk5Vvo0Ug4Uy8i7YQFe+NQhEg/wqEwkXBIILSwTgs0TaDzwqEQUaHHpL2YjCOLbPsxPY4MBr6zcTxD6x/fwHgGYmlH52vEJB3bW1aX14hi2JhkYUlsAVnYQucjGKDr2ATbzsC2LUkKTb7tfiiJhSjBzmDgGylLJk+XPxCk+0yQPBmNdCBfOr0vpN9M3r40nR6g7x/rPA1N1/FHYUgPXyCo/jq60X2RJWtKdvAD3wOd6pyDQQtT52fr/SfeX1AA+w9NC0RjX/rA9/4MDdB1vD90/f3La9rXhy8pgAEGDjZAXUZ3M4CBbx3vD11G0w7W3lebp3v8als8aGuKzJ+StzIw+qGUAg1AyR//wefrF4AwpgwDh9OJ0+3C7fPg9XvxB334c3z4gl58AR9enxe314PD5UIZThGBHpqS+OsNupcv0YNerxoHaKKfaa8wlZPrp6Aoh9LSXMrK8igvL6BCUFleRFVFMZUVhVQIyoRWVJJHbn5QhBLA6fKKMFzIC74mzTD4ih892y63m4DMamFxkFJhuKK8kMHVJTTWVzL9sDrOOW4ol3yznsvOquf7Z9Zz0anDOX3aEI4aX8uoIRVUlBdTLIIoLs0hvyAg2uHDcLpRakAzvrpBG1+uKa2iGsjgVEZ9tWoXCeN6pgdVFHFUYw1XnF3P//npOP7wq0bu/sVYfnnlGK48fxQXn1HPJSKAq789mplXjea+G8bw4M2N/M914/mOCGjsiCpKSosoLs2jsDD4tQjiSwqAzGM4HLhlbRcWBSmTwdZVFXH61MH8Whh5YMZYLjl9CAWeGpYvruSvj5Rx950l3Dozj5tvyuHmG/O4bWYBd99VxhOPVrHy7Sqqc+r48QVjePSOidxydQNTRDOKSwoo0hqR78fl8aAcbhG6A8hOAF/w+VICUErhcDkJBH2UleRSXpLPcYfWcPdPG5lxbT0V+RU8+3Qpv5pRzM23wwOP7eLJV5czd8V8Fmz8Jwu3zGZh0/Ms3PwC81Yu4Nl/r+Chv7Zw820JZvzSzz+fKaGhto4/zGjgth+Oo3FEhWhCLiWiYYGAR5aFwHDBlxCCwRd5tN0T5p1isXPzfGjjVldZyHXfGsFd148k31fKQ/eWcsstAf7+YguLt77K6r5ZrI+8wKa+N2nufp+tnRvZ3tHEjo4tbO3YRFP3CjaHX2dzYi4bkrN5b8+rPDV3MzNuMnjw/iLGVtfyyK2NfPebwykuzqe4JIfcXI9MgAu+hBAMPuejXXlk/3a5XeQW+CgtyadhSCm//tFIzjihmllPFHPbrfnMX9rMuvhsNkX/xbautexp76GrM0Wo15LDkUk8kiIRTcnBKi2HozR9PWl6uky6O9N0dPbR0rOJ5uSrbEy+wMtvbWLmDT7++VwRV397KHf+cDQ1Yl8KC3PIESE4ZSJUxkDyuR/j89ZQmnlR+/w8PyVFeUwaVcq9PxlKUU4Jt99cyuyXY2w157El9go723bTIwyF+kxisQSpRAIzFccyk9imiW3JGcGS2ExhpZOkUoK0iSabSYO+bosd0sZmaWtL+iX+8VyE228qYHRtBb+/vp7hg4rIzQuQE3TjED9DoW0CB332z/ycAlA4nS4COV4KxCofPrKYu35Yx549Rdx2exlrdm9hB/9ka3sT3V0WoXCKaDxOOpUQhlPYtimwBdmjkl5JGvQ/DqVwOBTVpV7G1QVIWzaJmE1Xh0lT22aaeI5VTU3MuKGAeF8xD/x8BPW1RQTFz/D53YgU+LzP5xCAwmE48fo95OcHGFMnTF9WR1NTEffcV8qu9FKaYwvZ0xYmFDKJRuOZGbWtNEqOwVlG9VuDjz1KKLYIwBABlBd4GDsogM/rFG1Ik0zGiYYsdreG2RCfR0t8Bb++s4i2lnzuu24INeV5mUnxeNwo5ZSWPnv4zAJQysDldZMnRq+qOJebLqymt6eABx4sod14h+be9+iWmYpEksTjcUxRcyXqrac7y7Koe+Ycrxh4DMPAEKEqw4Fm3hYDk0qarNkWYv4HvSQSojV6PQg9nU4RjyWlD4sNYkjb1Xvce08JyVABt3+vlrycAH6/C0OWAnzYB5/yfEYBKBzScFC2noA/wPdPqqBG1v9vHyqjw1rFtr7lGQMWjsVIJBNYMuuI+mYZR56BVHZgSqlMe56An9zSYrweLw6XG0uYTafT9IYS7NwTFpuRytCUUkjAFoHq9kNdyG6ymA5zHff8toQxVfl894RSkN3A5XKA+oxsIVUEnxqUNOj2OPGIBkypz+e0Kbk8+kQ52zpbRB3flfVuEosnSWcMmy0qv3+TSgh6UBIrhRamT9oryPdRWVuJnInwul0YhgNL2kjGE8SiCVIiDKWkvMOBUybAmbH2kBBj2dtj0hx/g+1tXTz1TBmDy904HNmyerx8xkeP6lOLKsPAI+srVxye7x8XZN2aEhavcNCultDVlSCdtjAcBm6ZRY/Xi7sfTvk2HE6UkllBZfrRb6fHQ15FGeUjx1LaMJGSYSMIFhXgkDYU2kiaaIOplBKaA4dhkFOUT4Foi1MZ6CeZsOjqidLmWMTS5X7mvu7A7RZ7I/mGlFdky/Epz2copdAzZkvDk4f6GFWdz9Pz/LTaS+gO94J05PUa5OV6KSzwZ6BnNle+tZMUlOn1ycHI5fGhHC5QCttMk5DLz2hXB7GONhK9naTiUWHaZuDRTGjoWXd7HBRXVVBaV4vH7cAlgrWwENtIa2QHe5Ib2dSkZCJS0rzC5XaiHE5pSgkOHj6TAAxDGnU5OP+IfBYuj7Kw5XVCdjN+bw7jRo3j1OPO4jtnXs7F5/2Qi8+9mvNOu5STp5/GxIZDqaupoqDAS26Ok6BokNvjkXVti1WP071rJx3rP6C3vZtYKCqGUy5bRQP0kJUI3FAKt8Mmx52muLIULYRcr4lsDjhRpE2bSCRNS2w1kVQ7sjKoLg9QLGcS3Q/KoZs6KIyD5kqmUpCSjgYXe1m0PsGMWZtRrhCNo47gBxf+kmu/d5swf40wfAHTjzibY488l9OOv4TvnnUd115yCz+5/A4Ryo+YdOiRlJXkEwx68MkSQRqOxU16OruIJWU2U2lEMtIjkiWdAp68HIrr66k75iSKGqdQOPYwhp90JlWNDQTllCgVSMdtWnv30BHdjWkrvnHUKCaMLsfjdWU0F7Jt8QnPpwrAlgZcYlxaexI8vqgVvROcftx3uPTcXzBu5CQcjlxCccThiZBMdcgstMn21U08mcJWOcL0SI6dchbXXDSTay6dyTFHHCszlIPf55SWlWxtaSmbFuOXziwB286OVA/bSiaJdnfR27KVWHsr8R5Jb99EuH0P6Zi+07cwxXMMi1sdk7I+Uf0xMqYjJ9Tiky3R43GhlG4p2+aB3p8qgGx1g2jKpiDXx1knXMK0SeeKVij6xFIHvdsZVvpvGqpmc0jNLCYOejaDxuo5DC56jYBjDaGoqHjax6hhh3P5BddzxYW/YMzIcaIJDrHuDhmkgY3qH5/YCFvmViSRFGeqd1cru9eup/WD5bR/sIwdq1bS1bKbuCwZS8pYsjWaetsVRgtEY4KFw2mor6Agz4vL7QLl4GDPpwtAKTE6DnL8DqZP/i8OHXcSPTIwpcKMKpnPuPLZVBWtFH+8DbcRwUpHsVI9+I0dVOYvZ+ygF5k6+FmGFb5NPNFFX8xF4+ijuPrimzn52NPR61VrlVeMpOFwoVRWENopMsWD1MsvYTkJd/WJregkYblIymoxxWewBJo5Q+o4HFBRWo7HVUlloZ/ywiAOh4EyDF3kE3HQXO27GU4HPo9iaM0gpkw4lb54Gr+rjcay5ynNW4OyDNatT/LkP9u567Ed/OqPzdwkmPnwTv734208PqeHxe9vw516lcPLn2ZE4SoisbjMfB7nnPIDvnvutYyql8NUUUBOdkFcbp8IwZldDqYlAk1jilMV7e4k0toqhk+RFv9AM2+LBmhx6e3XK7vDkJrhIMsu4LCpKPTiMAwB8uhSEh0gGJYony2QHuWdSWWKZVJKyYCcIgCDQ8YcjcdXgtPYQ0PFXLnz62FHi+LXTzQz84/reHTOZua/u40PmtrY1hqhuS3OquYoryzr5sG5Hcx8vIt7n9tEc9PT1HmfJ+jqIZqEiWOnc8UFMzl+6klyQZpPgdz4BAJ+nG43GA709iv8yxE6Sl9vSJi3sEQwtmgH2Cgp4xZVzw36GT64UU6bCjeK0nwPhnJiiBA4yGPoPIUCpdB/7PMYhsIpBrAgL5+hg8aL6sUYVf4mvpwo769NMPPhdbz45na27tyNMgzq6w/j6Cnf4oRpl8mu8ANOOfZyiS/h+KPOZfzY4zC9hzBvXS3PLN7M7m2P4bU2EREPMi+njDNPvIoLz/oRjWNHUVTkFd/eJ8sqiEeWhlKG9G0RT5mkZc0zwLxSuFwucYAc1FYOoq5yFPFkTMbsJD/oQI9J1wXFJz0ZAdiSq2dcY6CoLZWUUhjKprSgFH+giuLgBxQXt7Fuk8ldf93Ihq3tdId6hLnD+fkVM7j6vEs5+5jJTG8czGHDyxkzqIZhMqhBlUcyrO5UJo07jxMmfYfR9ZfSZR/Njtb12MkW2T1S6BPfmGFTuOTsG7ngtMuZKFtdRXkO+Xku2XlceL1uWTZuHA4XhtOFMlw4nG58Pq9srS4mjDkKtzOXhOwGCgufy5CxK1CKgz0yx0oUyZYyOpZon6BE8kp+P84JFiB3INQVbCTWY/HAU1vY2tLJHnFgastL+eaRwwh3/otly+7l3aV3s2b1/bRufxAj8idqfH9hfPFTjC2cT7F7LbYYSYdRSGXxIRQUnohp+2RCkxm1jkT7cBoeJo8/le+de1NmxzjtxLMzwhhUXUJxoZtgQKH3+NzcoKT9BPxOhtcNZfSQyUTk53xbLlcUKZCxI4/m6mAiEAGAgZKiiCAy0T4vJXk2SnkJOLtE0j38bV4bKza00tXXR0yOp83bWrnjoSe545EFPPDMWh6Y1cQ9TzVxp2jILX9ex61/eZ8/zlnCynWvUGbMZlrNP5hc/hKFzuWZ3SKeyhEfQpFMmSIEUfF0gli0V363F8Nb1cB/HX0h3z/nBq668GYuEd/j4vOvE8fqdAZVFhAIeNG7yJFinB2GV3aZmAgzgsuIiyaIPstSETt5AL7Y+8j8Zhm3DlDMltrCPrFEgG4AqgAADvVJREFUmnxfB227epm7aBfRWERc0IQIxiCRTgss3C4HAZ+DoMDjAdNM0NHTx9rmTl56q517nm3j+sd289sXmtm+630mFL/KKUOe57CSBRS7NmMmw4QjNqGYQSThlFjR0ZektTtJJOaltKCK4w8bxSmH5mMlOpCrAnJyHExumE516Rip20tC7hKcVkiYS8o5BbSPoHkgO79C/3gQAdiyYuyP54hAbJGgKSa4u7cLr+rmjRWdbNvdS1K8PLfLIxY7wNC6GqZMnCqG7gJOPPoKTjj6KklfybQjLmPShHMZNWIqlRVD8IsD39Hby7xlrdz2dCs3PNnFXEn7rFUcWfsKpw2dw3ESTyh5m2EFq6jLW0d90TrGV6xgYtUCypxP8O67v+G///gg8xavFQ1PccjIw2gYehx66aTkIBCPp0RTu0X6SRFcQibBFI2wEFb4pMfYP2NAE5SITQsgnbbp7m2nva2Ndz/oFnWNYxhOiuVufurhx/CNqVczaey3OEoORSc3BDmjMcF54yNcNMnkiunFXHXC4Vx07Fkce/jF4qGdKf5EIzmBAJt29vGn+W38/Mlu7n4hxKurO+jq3kgOb1PheY0yzzxUXK7It8zlby+/wq2Pvc2fXtzB9vY0OUFDmJ/ExPpviNudICE3UEm5cI3GEhT7OgmHTfZ0xDLMixILiweaYCFLEA2Q9z5BF9VQQrNl9vXa7OnrYsnKtWzc1pdpNOh3MaVhmkj/LIaV2EwfsoRq7xy2b3+OV997gX+8+SLPL36JRStfpL19DkNzXuFb49Zz8aQA00ZPY/Tg82kcfgrDq0dhiX15a3Mvv5/fzvVPt3P1I+1c+eAervrDHn788G7ueKqVWa93sbklhGlGZSnkcsTYk2gYfKKcI5Iy+1G5OE0Sk/NAOhGhJreLbXtStMldgSmXK1qDD6YCezVAM6whfO8NSnQnlTIJRWM8s3AVzbtDOMR1qqscTG3ZVCZUbWZQ7nz+/PIi/tef1/I/s7bzl1f38NySDua808XfF3dz/7x2bn52G/f9ayVbWl5jau0CzhrTTF1+JaXB6TRUn8r4wdOpK6vH5w7SF4mws72dXXL46e3rxEyFxL6kKS0s4JD6KUxr/BaDiiai/0krHtezb5JIJAnLsTjH2UWOP8byLVG5kY6REvtk2+Zefg6UyAhAM65E5dXeEloHyFBs8bdjsZQw30lPOIrfY1CcP4Ypw1rp7X2Dax9ew7OLdrOztYNIpBNDpSnIKaKieLicEUZSkl+Dw+Fn7a44Dyzo5EYRxtqW5Zw2+nWOqdsgV+YyhPQQBudP4ZBBp3LEyDOYNPIEJg4/JoMjRp0gfsXZTGs4n9HV03CJqxuS7TIiLnlMbFE82UMiLgIQt3J0aSvCNe9u6BaHKE5abqrs7Brgk57MNqjZtWS2xVxgZNhWe8sbkjJlb02Jg2HLqUspH2OrgoR63mXmExvlqlo6i/TKFpRmUNk4Tmo4gzMn/hdnNkzmpJHjmVwzhWHFJ1JdNJ3aomH0yfn9dws6mDF7B8pexWWTlzO+fKs4VBG6ep3CYDmVeWMZWnoYwwQ1hQ3keqsygurqC9HRGxe1VwRcIZyslV+YYoSjJj7Vy2HVfazaEmfd9m45lqcx5ajMpwlA+MswrWMNOyMIGy0Q/a2hl4ItO4KGU3ko8bXx+xfX0N4dJixaYdlOptQfyukThtBQtYvK3KVU5C8R9V7KOYes5MfTt3PBeJdY9omUB45niAiipSvJr17YzR/+3cSI0tVceeQ6pg3bRa6ziz65amvtCrGzM4u27oiofJKgI0l9SS+jq9aRMt+mvdOHlfTTE4pxZF07ymXxwtJWEVKYhOyTlnabhR/NwychYwQtKTQw51obBvDRSuKspMFtpFiyZgOrt3aQkrVniaHMFXe0q69ZOp/PY68v46H5m7jnpa3cNruZW+ds4ZllG0Qga/jZCes5YXgat9lIdWAq5TlVLNoc5mezWnhkyQY8rtV8s3EDl05pFoO5g29P3M15E3ZxzoQWvtG4hXGDVtKbXsybGzexeesQSBbR3htjaH4PRw+PsWxtmDfW7SGudwU5M9uZ2bc/ysZ+X1rD95IGhGDIMnAI9mZkEqIVItHW7h4WrGxCX4PbohVBrwvTStAqnqHH6WVwUZCRZUGq8zyiziY7O0K8tLxD1n4LDy/aynGjt3Dd8S0ExPo7YxMZEphMjqOSxZuS3P5SC7+Ys57fvrGW59Z8wGvNK1komLN2BY++tZqH39zJm6vySfdMJGDniaMUId/bx+WH9ZGQX6MeeaOZNtHKqNistOwAenyZoR/kZWhGDSmg5aQhSdEHMkvAltQALUO3bbrkJmaPXE7YYhzdDkMMnMXRowq59/wGHv3uBO4/bxy/OXM0vzt3FPedNZqrjh5MQ2UQS34UfXllKz95pplQcif/ffYexlT2yN6fS8AaR61nMhXORqxIBZu2e1i0xmb+SovXP3CwZnM+ofbB5MUnUMwwVNpml8x8USDCz6aG8fvhvteaWSaHs3A0QTKRxrZMGfK+o5fPAwTN+8fIA4xro2iJEPYWEAFYYgg1lLTt8zq4ZOo4fnjUNMJ9w/jbm4XcNTuHO5/386cFfrbuyuHE+jLuPH0E1xw9lJp8L3s6e7lNlsU/ljfzk1O6ufSoHiLiWnf1ODFSZeSmR1CcHkuZ2UBZupEycyxFVj0BswIr6aAzFKE9HOfQuhB3nBSnKAfuX7CFF1Zvo08mJyrOkGmlZMh69BJ9SsjYAPUxdf+wlpaQLYxnKcK1FohEltAq5BzftDOPax5fzy1zVvP00k0sXL+LNzb0Mutdkxtnubj8T27+9a6LY4YXc/8ZozluRAXabX1s0TaxDxs4cngXv7sgzmF1UfqiYXb1REW1E/TKL8t94tz0hJOyzqPsFkPYG43K7hDnxpMT/PRkm95EnF/NXcPTy5pkB4nSF0lK2yls+7Mxr3nS/AlL9ieKQAtHQxcegC01DOVge2cbCzcsojOxggTLiJrvELb+TYzXwP0aHt877Aw3c8+8OFc9bLC6ycd1xw/j+mOHU+hzsXDdbq56cjXv79rK9adE+MO3Ta48xuLIYRaDi1NU5SclTorPkeb7U03uvwDuPMfB6PIk/3hnO9c8u5y5a3bQ2SvMi1Zowdr2Z1P9AV4MJSlbsG/QNA1NM4VZS/TdkvjDcjbazYynkzjEL8hjMn7rcFHhEZjxaiJRP519cVpD24iYS3Hn/Jtt4eXcOLuV256E0QW1/PGcRo4ZVkxTe4jb/7WBa2et5O0dWzhUNOJn3zS590IHv7/YmYlvON3m5PFJOhKd/HbhBi76+3v8ev4aVsudRLfYgpAwn9T/g/AZ173mawCGJYyp/vlXA9RM/OHXAON65jNZUt4USSflqjwsx9je5HZ8qpIi50QKHIdSZEyh0JhK0DoKYuPFPpSTlmOqN/d93t79Npc/sZXZS4P89Kjx3HLSCCpy3LyztZPfvLaJy59exWXPrOSncz9gxitruEFU/AfPrOL8/7uMHzy9nIcWref9be109UTp7YuJExQnJRORNXpWdnif4y0aoMgKAQxhTNfVDH/ILBmqQ94D+cij89NibJIpi+7EdrZGXqYnuVG2D6ltGZB24DJz5d6vBm96DIQnE+k6FMMswXbv5PEVy7hCLkp7uuu48bgJXD2ljqFFbmEoynJhcO7qFp5Zvp1nV27j9Y272NLaTU9fhLA4PdrYRSIxOZYnscykrHmt9jKoLxBEAAhrMm6ykCgTlLw1JMoEUzTF6odmPkMUY5MyUzIDirhsc7viS9mdeEfu7rulTQe2ZctSSQhkkLJtkgqQ6Ksj3DEBr1krRqyN37zSzoxn/HR3DudM8SavmjyWiybWcvKIYiZVFzCxoohRZXkE3S5xcJLi4SXF0CXF90hh2+KZyZgyY/mCL0Mzphk1ZMh7GetvTAlNJ2VOdfQR2KI3SOfa4qZkFpLptPjr0JPcQUt8Ea3p94jSjm7CwI2yRIekIYUMWtZqIpIne/5QCjxuesXSP/1Wmvtf8vDikipat44lN3I4VcY48py59IVjdImhS6XTWCJIhQXSt7y+dDAMacLOwNZjzUA+M81bmbf+ynan9uZqmi25AwOxZY2nictaTIpdiKVSdMa3sjO+hJ3JRXSYKwmznaTdg2knMvWUYaLEuJopv9zhKfL8aRzOCFt7Wnm9aSNz1r/Ds2tf56U1a1i7s4uw/BaoDzda4Lr3rwrCv5IBZRnMNqqy0T5vAyV/Ukb2fiV0O1NDEhJsmQ0NdJxZEkkSA4KQO7q+eCdt8Y3sjL3H9sQidiTeYGdqMTsTIpzEW+xKLqYlsZhtojXbYm+wO72ILmMZIaOJuBUSwZoy62lZRiaWGF726Vu6/9LBsKVBzZRuyZaX/pZob9B5hnwpLQIlCQlKpyX+MOhaWhtMIVnYouJpsQ1JEURCLlQSSVt+AjeJyCElHA+jhdIT30N3fGcGPYk9QusimogQjScFFtGYRVxc2lQqKYbOxBbhftXMy2DRvOkY0cZsLG9DGFQSDwTNmk5rAem0JULT3/tDi8HWmkBWEMigLTFUptiItAgjlU5ltSOZJJlK9yNFUr5TyQQJ2cu14LRlt0SAtuwyWpj21zDzA2MXDcjK1d7L8d5EpkyW6SxbhlB0roYkDxqyNWTmMgKxRWT9LYlQtA/xIWyxCxqWqLguZ2FLGaQeUuugnXwFmZqnjzSjh6CHqkQLPpIhH3r2Nd04QJ5kf0LQremawpgwZX8MWSFZGbrWHF3+E5r6GsjGgdq0RfKWQEmm0c+sTmsM5EnW1xT+PwlAM7cvNHf7fisRhBaGhs77+qC+vqYP0LIh7gkOMQCasX2h6UqY1nU0XelEP1Q/vf/zK47+4xpggBJkNgQFmViiDJNKEhqSbzvEJum06s9RkvdFg64rbUpLSkAG+q2kdwOlHCgZ00ehaQI+CqSGypQX+ueJ+9sxvD4/Gj6JM/D78PkDeOWeSdOzsU++NaSs0HV+IBAkC7/EGgGJBzCQp7/3z9O0fvilnCA40JakffKzmV/G4Jd+/P6AXHdl4Qv4ZVw+/DreBwFJZ8tLXqaeL1uuP/3RPGlDyvt0nsS6rf8HAAD//+viZ5QAAAAGSURBVAMAjxSHsz7dKhUAAAAASUVORK5CYII=">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
        
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: #000;
                color: #fff;
                overflow-x: hidden;
                width: 100%;
            }
        
            body.no-scroll {
                overflow: hidden !important;
                height: 100vh;
            }
        
            html,
            body {
                width: 100%;
                max-width: 100%;
                overflow-x: hidden;
                position: relative;
                margin: 0;
                padding: 0;
            }
        
            #loading-screen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #000;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                transition: opacity 0.8s ease;
            }
        
            #loading-screen.fade-out {
                opacity: 0;
                pointer-events: none;
            }
        
            .glitch-text {
                font-size: 80px;
                font-weight: 900;
                letter-spacing: 10px;
                position: relative;
                animation: glitch 2s infinite;
                cursor: default;
            }
        
            @keyframes glitch {
        
                0%,
                100% {
                    opacity: 1;
                    text-shadow: 0 0 20px #00ff88, 0 0 40px #00ff88;
                }
        
                25% {
                    opacity: 0.8;
                    text-shadow: -2px 0 #ff0088, 2px 0 #00ff88;
                    transform: translate(-2px, 0);
                }
        
                50% {
                    opacity: 1;
                    text-shadow: 2px 0 #00ff88, -2px 0 #ff0088;
                    transform: translate(2px, 0);
                }
        
                75% {
                    opacity: 0.7;
                    text-shadow: 0 0 30px #00ff88;
                }
            }
        
            .progress-container {
                width: 400px;
                height: 4px;
                background: #111;
                border-radius: 10px;
                overflow: hidden;
                margin-top: 40px;
            }
        
            .progress-bar {
                height: 100%;
                background: #00ff88;
                width: 0%;
                transition: width 0.3s ease;
            }
        
            #app {
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.8s ease;
                min-height: 100vh;
                padding: 60px 20px;
            }
        
            #app.visible {
                opacity: 1;
                pointer-events: all;
            }
        
            .background-text {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 200px;
                font-weight: 900;
                color: rgba(255, 255, 255, 0.01);
                z-index: 0;
                user-select: none;
                pointer-events: none;
            }
        
            .container {
                max-width: 700px;
                margin: 0 auto;
                position: relative;
                z-index: 1;
            }
        
            .input-group {
                margin-bottom: 10px;
            }
        
            label {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                font-size: 13px;
                color: #888;
                font-weight: 500;
            }
        
            .api-link-btn {
                color: #00ff88;
                text-decoration: none;
                font-size: 11px;
                border: 1px solid rgba(0, 255, 136, 0.3);
                padding: 4px 10px;
                border-radius: 20px;
                transition: all 0.3s ease;
                background: rgba(0, 255, 136, 0.05);
                display: inline-flex;
                align-items: center;
                gap: 5px;
            }
        
            .api-link-btn:hover {
                background: rgba(0, 255, 136, 0.15);
                border-color: #00ff88;
                box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
                transform: translateY(-1px);
            }
        
            textarea {
                width: 100%;
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 8px;
                padding: 14px;
                color: #fff;
                font-size: 15px;
                transition: all 0.2s ease;
                outline: none;
                min-height: 100px;
                resize: none;
                overflow-y: hidden;
                display: block;
            }
        
            textarea:focus {
                border-color: #00ff88;
            }
        
            #magic-wand-btn {
                position: absolute;
                bottom: 10px;
                right: 10px;
                background: rgba(10, 10, 10, 0.8);
                border: 1px solid #333;
                color: #888;
                width: 32px;
                height: 32px;
                border-radius: 6px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                backdrop-filter: blur(4px);
            }
        
            #magic-wand-btn.disabled {
                opacity: 0.3;
                pointer-events: none;
                filter: grayscale(100%);
                cursor: not-allowed;
                transform: scale(0.9);
                border-color: #222;
            }
        
            #magic-wand-btn:hover {
                border-color: #00ff88;
                color: #00ff88;
                background: rgba(0, 255, 136, 0.1);
                transform: scale(1.05);
                box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
            }
        
            #magic-wand-btn.loading {
                animation: magic-pulse 1.5s infinite;
                pointer-events: none;
                color: #00ff88;
                border-color: #00ff88;
            }
        
            @keyframes magic-pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4);
                }
        
                70% {
                    box-shadow: 0 0 0 10px rgba(0, 255, 136, 0);
                }
        
                100% {
                    box-shadow: 0 0 0 0 rgba(0, 255, 136, 0);
                }
            }
        
        
            #moderation-btn {
                position: absolute;
                bottom: 10px;
                right: 50px;
                background: rgba(10, 10, 10, 0.8);
                border: 1px solid #333;
                width: 32px;
                height: 32px;
                border-radius: 6px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                backdrop-filter: blur(4px);
                z-index: 10;
            }
        
            #moderation-btn:hover {
                transform: scale(1.05);
            }
        
            .mod-icon {
                width: 18px;
                height: 18px;
                position: absolute;
                opacity: 0;
                transform: scale(0.5);
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            }
        
        
            #moderation-btn[data-level="high"] {
                border-color: rgba(0, 255, 136, 0.3);
                color: #00ff88;
            }
        
            #moderation-btn[data-level="high"]:hover {
                background: rgba(0, 255, 136, 0.1);
                box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
            }
        
            #moderation-btn[data-level="high"] .icon-high {
                opacity: 1;
                transform: scale(1);
            }
        
            #moderation-btn[data-level="medium"] {
                border-color: rgba(255, 170, 0, 0.3);
                color: #ffaa00;
            }
        
            #moderation-btn[data-level="medium"]:hover {
                background: rgba(255, 170, 0, 0.1);
                box-shadow: 0 0 10px rgba(255, 170, 0, 0.2);
            }
        
            #moderation-btn[data-level="medium"] .icon-medium {
                opacity: 1;
                transform: scale(1);
            }
        
            #moderation-btn[data-level="low"] {
                border-color: rgba(255, 68, 68, 0.3);
                color: #ff4444;
            }
        
            #moderation-btn[data-level="low"]:hover {
                background: rgba(255, 68, 68, 0.1);
                box-shadow: 0 0 10px rgba(255, 68, 68, 0.2);
            }
        
            #moderation-btn[data-level="low"] .icon-low {
                opacity: 1;
                transform: scale(1);
            }
        
            #api-key {
                transition: filter 0.2s ease, letter-spacing 0.2s ease, color 0.2s ease;
            }
        
            #api-key.decrypt-effect {
                filter: blur(4px);
                letter-spacing: 3px;
                color: #00ff88;
            }
        
            #toggle-api-key {
                position: absolute;
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                color: #666;
                cursor: pointer;
                padding: 5px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: color 0.2s ease;
            }
        
            #toggle-api-key:hover {
                color: rgb(var(--primary-rgb));
            }
        
            #eye-icon {
                transition: all 0.3s ease;
            }
        
            #eye-slash {
                transition: opacity 0.3s ease;
            }
        
            #api-key.hacker-active {
                color: var(--primary) !important;
                letter-spacing: 1px;
                text-shadow: 0 0 5px var(--primary);
                transition: none; 
            }

            .model-selector {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 18px;
            }
        
            .model-info-icon-wrapper {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 24px;
                height: 24px;
                z-index: 20;
                color: rgba(255, 255, 255, 0.6);
                background: rgba(0, 0, 0, 0.4);
                backdrop-filter: blur(4px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                cursor: pointer;
            }
        
            .model-info-icon-wrapper:hover {
                color: #00ff88;
                background: rgba(0, 255, 136, 0.15);
                border-color: #00ff88;
                transform: scale(1.1);
                box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
            }
        
            @media (max-width: 768px) {
                .model-info-icon-wrapper {
                    width: 28px;
                    height: 28px;
                }
            }
        
            .model-card {
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 8px;
                padding: 16px;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                min-height: 140px;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .model-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-size: cover;
                background-position: center;
                background-image: var(--bg-image); 
                opacity: 0.8;
                transition: opacity 0.4s ease;
                z-index: 0;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .model-card::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(to bottom, rgba(10, 10, 10, 0.7), rgba(10, 10, 10, 0.95));
                z-index: 1;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .model-card:hover {
                border-color: #444;
                filter: saturate(0.7) !important;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .model-card:hover::before {
                opacity: 1;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .model-card.active {
                border-color: #00ff88;
                background: rgba(0, 255, 136, 0.05);
                transform: scale(1.1);
                filter: saturate(1.1) !important;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .model-card.active::before {
                opacity: 1;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .model-name {
                font-size: 15px;
                font-weight: 600;
                margin-bottom: 4px;
                position: relative;
                z-index: 2;
                -webkit-user-select: none; 
                -moz-user-select: none;   
                -ms-user-select: none;
                user-select: none;
            }
        
            .model-card.active .model-name {
                color: #00ff88;
                text-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .confetti {
                position: fixed;
                width: 8px;
                height: 8px;
                background: #00ff88;
                pointer-events: none;
                z-index: 9999;
                will-change: transform, opacity;
            }
        
            @keyframes confetti-burst {
                0% {
                    opacity: 1;
                    transform: translate(0, 0) rotate(0deg) scale(1);
                }
        
                100% {
                    opacity: 0;
                    transform: translate(var(--tx), var(--ty)) rotate(720deg) scale(0);
                }
            }
        
            .aspect-ratio-selector {
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
                padding: 10px;
                margin: -10px;
                width: calc(100% + 20px);
            }
        
            @media (max-width: 768px) {
        
                .aspect-btn:hover,
                .aspect-btn.active {
                    transform: scale(1.05);
                }
            }
        
            .extras-selector {
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
                margin-top: 5px;
            }
        
            .extra-btn {
                flex: 1;
                min-width: 100px;
                padding: 12px;
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 6px;
                color: #888;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 13px;
                font-weight: 500;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                position: relative;
                overflow: hidden;
            }
        
            .extra-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(var(--primary-rgb), 0.08);
                opacity: 0;
                transition: opacity 0.4s ease;
                z-index: 0;
            }
        
            .extra-btn:hover:not(:disabled) {
                border-color: #444;
                color: #fff;
            }
        
            .extra-btn:hover:not(:disabled)::before {
                opacity: 1;
            }
        
            .extra-btn.active {
                background: rgba(0, 255, 136, 0.05);
                border-color: #00ff88;
                color: #00ff88;
                transform: scale(1.05);
                box-shadow: 0 0 10px rgba(0, 255, 136, 0.1);
            }
        
            .extra-btn.active::before {
                opacity: 0.5;
            }
        
            .extra-btn.active:hover {
                background: rgba(0, 255, 136, 0.1);
                border-color: #00ff88;
                color: #00ff88;
            }
        
            .extra-btn:disabled {
                opacity: 0.3;
                cursor: not-allowed;
                filter: grayscale(100%);
                border-color: #222;
                transform: none !important;
            }
        
            .info-icon-wrapper {
                position: absolute;
                top: 4px;
                left: 4px;
                width: 16px;
                height: 16px;
                z-index: 10;
                color: #444;
                transition: color 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
            }
        
            .info-icon-wrapper:hover {
                color: rgba(var(--primary-rgb), 1);
                background: rgba(255, 255, 255, 0.1);
            }
        
            .feature-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(12px) opacity(0.6);
                z-index: 30000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease, visibility 0.3s ease;
                will-change: opacity;
            }
        
            .feature-modal.active {
                opacity: 1;
                visibility: visible;
            }
        
            .feature-info-card {
                background: #111;
                border: 1px solid rgba(var(--primary-rgb), 0.5);
                border-radius: 16px;
                padding: 24px;
                width: 320px;
                transform: scale(0.95);
                transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
                position: relative;
                will-change: transform;
            }
        
            .feature-modal.active .feature-info-card {
                transform: scale(1);
            }
        
            .feat-title {
                font-size: 18px;
                font-weight: 700;
                color: #fff;
                filter: saturate(4.5);
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .feat-desc {
                font-size: 13px;
                color: #888;
                filter: drop-shadow(0px 0px 10px);
                line-height: 1.5;
                margin-bottom: 20px;
                border-bottom: 1px solid #222;
                padding-bottom: 15px;
            }
        
            .metric-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
                font-size: 13px;
                color: #ccc;
            }
        
            .metric-dots {
                display: flex;
                gap: 4px;
            }

            .rating-icon {
                width: 14px;
                height: 14px;
                fill: #333;
                transition: all 0.3s ease;
            }

            .rating-icon.filled:nth-child(1) { fill: var(--dot-filled-1); filter: drop-shadow(0 0 2px var(--dot-filled-1)); }
            .rating-icon.filled:nth-child(2) { fill: var(--dot-filled-2); filter: drop-shadow(0 0 4px var(--dot-filled-2)); }
            .rating-icon.filled:nth-child(3) { fill: var(--dot-filled-3); filter: drop-shadow(0 0 6px var(--dot-filled-3)); }
            .rating-icon.filled:nth-child(4) { fill: var(--dot-filled-4); filter: drop-shadow(0 0 8px var(--dot-filled-4)); }
            .rating-icon.filled:nth-child(5) { fill: var(--dot-filled-5); filter: drop-shadow(0 0 10px var(--dot-filled-5)); }
        
            .aspect-btn {
                flex: 1;
                min-width: 70px;
                padding: 10px;
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 6px;
                color: #888;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 13px;
                font-weight: 500;
                position: relative;
                overflow: hidden;
            }
        
            .aspect-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(var(--primary-rgb), 0.08);
                opacity: 0;
                transition: opacity 0.4s ease;
                z-index: 0;
            }
        
            .aspect-btn:hover {
                border-color: #444;
                color: #fff;
            }
        
            .aspect-btn:hover::before {
                opacity: 1;
            }
        
            .aspect-btn.active {
                background: rgba(0, 255, 136, 0.05);
                border-color: #00ff88;
                color: #00ff88;
                transform: scale(1.1);
            }
        
            .aspect-btn.active::before {
                opacity: 0.5;
            }
        
            .generate-btn {
                width: 100%;
                padding: 16px;
                font-size: 15px;
                font-weight: 600;
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 8px;
                color: #444;
                cursor: not-allowed;
                transition: all 0.5s ease;
                margin-top: 24px;
                position: relative;
                overflow: hidden;
            }
        
            .generate-btn.ready { 
                background: rgba(var(--primary-rgb), 0.05) !important; 
                border-color: var(--primary) !important; 
                color: var(--primary) !important; 
                box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.1) !important;
            }

            .glitch-text.gradient-active {
                background: var(--theme-bg);
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                text-shadow: none !important;
                filter: drop-shadow(0 0 10px rgba(var(--primary-rgb), 0.5));
            }

            .model-card.active, .aspect-btn.active, .extra-btn.active {
                border-color: var(--primary) !important;
                -webkit-user-select: none !important; 
                -moz-user-select: none !important;   
                -ms-user-select: none !important;
                user-select: none !important;
            }
        
            .generate-btn.generating {
                animation: pulse 2s ease-in-out infinite;
                cursor: wait;
            }
        
            @keyframes pulse {
                0% {
                    box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
                }
        
                50% {
                    box-shadow: 0 0 50px rgba(0, 255, 136, 0.75);
                }
        
                100% {
                    box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
                }
            }
        
            .generate-btn.ready::before {
                content: '';
                position: absolute;
                top: -1px;
                left: -100%;
                width: 100%;
                height: calc(100% + 2px);
                background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.4), transparent);
            }
        
            @keyframes outline-move {
                to {
                    left: 100%;
                }
            }
        
            .generate-btn.ready:active {
                transform: scale(0.98);
            }
        
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background: #0a0a0a;
                border: 1px solid #00ff88;
                border-radius: 8px;
                padding: 12px 18px;
                color: #fff;
                z-index: 50000 !important;
                animation: slideIn 0.4s ease;
                font-size: 14px;
                display: flex;
                align-items: center;
                gap: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
                max-width: 350px;
                backdrop-filter: blur(10px);
            }
        
            .notification-spinner {
                width: 20px;
                height: 20px;
                border: 2px solid rgba(0, 255, 136, 0.2);
                border-top-color: rgba(var(--primary-rgb), 1);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                flex-shrink: 0;
            }
        
            .notification-thumb {
                width: 40px;
                height: 40px;
                border-radius: 6px;
                object-fit: cover;
                border: 1px solid rgba(0, 255, 136, 0.5);
                background: #222;
                cursor: pointer;
                transition: transform 0.2s ease;
                flex-shrink: 0;
            }
        
            .notification-thumb:hover {
                transform: scale(1.1);
                border-color: #fff;
            }
        
            .notification.clickable {
                cursor: pointer;
            }
        
            .notification.clickable:hover {
                background: #111;
            }
        
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
        
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        
            .gallery-btn {
                position: fixed;
                bottom: 1%;
                left: 50%;
                backdrop-filter: blur(2px);
                transform: translateX(-50%);
                padding: 12px 32px;
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 30px;
                color: rgba(var(--primary-rgb), 1);
                font-size: 14px;
                font-weight: 600;
                width: 80%;
                cursor: pointer;
                transition: all 0.2s ease;
                z-index: 100;
            }
        
            .gallery-btn:hover {
                border-color: #00ff88;
                color: #00ff88;
            }
        
            .gallery-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0);
                z-index: 10000;
                visibility: hidden;
                opacity: 0;
                transition: all 0.4s ease;
                display: flex;
                align-items: flex-end;
                justify-content: center;
            }
        
            .gallery-modal.active {
                visibility: visible;
                opacity: 1;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
            }
        
            .gallery-content {
                width: 100%;
                max-width: 1000px;
                height: 85vh;
                background: rgba(20, 20, 20, 0.4);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                border-radius: 40px 40px 0 0;
                padding: 20px 30px;
                transform: translateY(100%);
                transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
                display: flex;
                flex-direction: column;
                position: relative;
                overflow: hidden;
            }
        
            .gallery-modal.active .gallery-content {
                transform: translateY(0);
            }
        
            .modal-handle {
                width: 60px;
                height: 4px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                margin: 0 auto 20px auto;
                flex-shrink: 0;
            }
        
            .gallery-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                flex-shrink: 0;
            }
        
            .gallery-title {
                font-size: 28px;
                font-weight: 700;
                color: #00ff88;
                cursor: default;
            }
        
            .close-btn {
                font-size: 32px;
                color: #888;
                cursor: pointer;
                border: none;
                background: none;
                transition: all 0.2s ease;
            }
        
            .close-btn:hover {
                color: rgb(var(--primary-rgb));
            }
        
            .gallery-controls {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
                flex-shrink: 0;
                flex-wrap: wrap;
            }
        
            .search-container {
                flex: 1;
                min-width: 200px;
                position: relative;
            }
        
            .search-input {
                width: 100%;
                background: #111;
                border: 1px solid #333;
                padding: 10px 15px 10px 40px;
                border-radius: 12px;
                color: #fff;
                font-size: 14px;
                outline: none;
                transition: all 0.2s ease;
            }
        
            .search-input:focus {
                border-color: #00ff88;
                box-shadow: 0 0 10px rgba(0, 255, 136, 0.1);
            }
        
            .search-icon {
                position: absolute;
                left: 12px;
                top: 50%;
                transform: translateY(-50%);
                color: #666;
                pointer-events: none;
            }
        
            .control-btn {
                background: #111;
                border: 1px solid #333;
                color: #ccc;
                padding: 10px 15px;
                border-radius: 12px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 8px;
                transition: all 0.2s ease;
            }
        
            .control-btn:hover,
            .control-btn.active {
                border-color: #00ff88;
                color: #00ff88;
                background: rgba(0, 255, 136, 0.05);
            }
        
            .filter-panel {
                background: #0f0f0f;
                border: 1px solid #222;
                border-radius: 16px;
                padding: 20px;
                margin-bottom: 20px;
                display: none;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 15px;
                animation: slideDown 0.3s ease;
            }
        
            .filter-panel.active {
                display: grid;
            }
        
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
        
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        
            .filter-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
        
            .filter-label {
                font-size: 12px;
                color: #888;
                font-weight: 600;
                text-transform: uppercase;
            }
        
            .filter-select,
            .filter-date {
                background: #1a1a1a;
                border: 1px solid #333;
                color: #fff;
                padding: 10px;
                border-radius: 8px;
                font-size: 13px;
                outline: none;
                width: 100%;
            }
        
            .filter-select:focus,
            .filter-date:focus {
                border-color: rgb(var(--primary-rgb));
            }
        
            ::-webkit-calendar-picker-indicator {
                filter: invert(1);
                opacity: 0.5;
                cursor: pointer;
            }
        
            .reset-filters-btn {
                grid-column: 1 / -1;
                background: #1a1a1a;
                border: 1px dashed #444;
                color: #666;
                padding: 10px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 13px;
                transition: all 0.2s ease;
                text-align: center;
            }
        
            .reset-filters-btn:hover {
                color: #ff4444;
                border-color: #ff4444;
                background: rgba(255, 68, 68, 0.05);
            }
        
            .gallery-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                grid-auto-flow: dense;
                gap: 12px;
                overflow-y: auto;
                flex: 1;
                min-height: 0;
                padding-bottom: 40px;
                scrollbar-width: thin;
                scrollbar-color: #333 transparent;
            }
        
            .gallery-grid::-webkit-scrollbar {
                width: 6px;
            }
        
            .gallery-grid::-webkit-scrollbar-thumb {
                background-color: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
            }
        
            @keyframes galleryPopIn {
                0% {
                    opacity: 0;
                    transform: scale(0.9) translateY(30px);
                    filter: blur(10px);
                }
        
                100% {
                    opacity: 1;
                    transform: scale(1) translateY(0);
                    filter: blur(0);
                }
            }
        
            .gallery-item {
                opacity: 0;
                position: relative;
                border-radius: 20px;
                overflow: hidden;
                background: #0a0a0a;
                transition: transform 0.3s ease, border-color 0.3s ease;
                border: 1px solid rgba(255, 255, 255, 0.05);
                cursor: pointer;
                min-height: 200px;
            }
        
            .gallery-item.show {
                animation: galleryPopIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            }
        
            .gallery-item:hover {
                border-color: rgba(var(--primary-rgb), 0.8);
                z-index: 2;
            }
        
            .gallery-item.wide {
                grid-column: span 2;
            }
        
            .gallery-item.tall {
                grid-row: span 2;
            }
        
            .gallery-item.big {
                grid-column: span 2;
                grid-row: span 2;
            }
        
            .gallery-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
                transition: transform 0.5s ease;
            }
        
            .gallery-item:hover img {
                transform: scale(1.1);
            }
        
            .gallery-item-info {
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                padding: 20px 15px 15px 15px;
                background: linear-gradient(to top, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.6) 60%, transparent 100%);
                color: #fff;
                opacity: 1;
                transition: opacity 0.3s ease;
                pointer-events: none;
            }
        
            .info-prompt {
                font-size: 13px;
                font-weight: 600;
                color: #fff;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                margin-bottom: 4px;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            }
        
            .info-meta {
                font-size: 11px;
                color: #00ff88;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
        
            .empty-gallery {
                text-align: center;
                color: #444;
                font-size: 15px;
                padding: 60px;
                grid-column: 1 / -1;
            }
        
            #lightbox {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 10001;
                display: flex;
                justify-content: center;
                align-items: center;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease, visibility 0.3s ease;
                background: rgba(0, 0, 0, 0.4);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
            }
        
            #lightbox.active {
                opacity: 1;
                visibility: visible;
            }
        
            .lightbox-delete-btn {
                position: absolute;
                top: 15px;
                right: 15px;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                border: 1px solid rgba(255, 50, 50, 0.3);
                color: #ff4444;
                width: 36px;
                height: 36px;
                border-radius: 8px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                z-index: 10;
            }
        
            .lightbox-delete-btn:hover {
                background: rgba(255, 50, 50, 0.2);
                border-color: #ff4444;
                transform: scale(1.05);
                box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
            }
        
            .lightbox-close-btn {
                position: absolute;
                top: 15px;
                left: 15px;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #fff;
                width: 36px;
                height: 36px;
                border-radius: 20px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                z-index: 20;
            }

            .lightbox-close-btn:hover {
                background: rgb(0 0 0 / 0.8);
                transform: scale(1.1);
                color: #ffffff;
            }

            @media (max-width: 768px) {
                .lightbox-close-btn {
                    top: 10px !important;
                    left: 10px !important;
                }
                .info-meta {
                    font-size: 0.7rem !important;
                }
            }

            .lightbox-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
                transform: scale(0.9);
                background: rgb(30 30 30 / 0.5);
                border-radius: 35px;
                transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            }
        
            #lightbox.active .lightbox-content {
                transform: scale(1);
            }
        
            .lightbox-image-wrapper {
                position: relative;
                max-height: 75vh;
                width: fit-content;
                margin: 0 auto;
                display: flex;
                justify-content: center;
            }
        
            .lightbox-image {
                max-width: 100%;
                max-height: 75vh;
                display: block;
                object-fit: contain;
                border-radius: 12px;
                box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            }
        
            .lightbox-download-btn {
                position: absolute;
                bottom: 15px;
                right: 15px;
                left: auto;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #fff;
                padding: 8px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 6px;
                transition: all 0.2s ease;
                text-decoration: none;
            }
        
            .lightbox-share-btn {
                position: absolute !important;
                bottom: 10px !important;
                left: 60px !important;
                width: 40px;
                height: 40px;
                border-radius: 12px;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #fff;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 30;
                transition: all 0.2s ease;
                margin: 0 !important;
            }

            .lightbox-share-btn:hover {
                background: #00ff88;
                color: #000;
                border-color: #00ff88;
                transform: scale(1.1);
            }

            @media (max-width: 768px) {
                .lightbox-share-btn {
                    left: auto !important; 
                    right: 10px !important; 
                    bottom: 10px !important;
                }
            }

            #share-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(8px);
                z-index: 25000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }

            #share-modal.active {
                opacity: 1;
                visibility: visible;
            }

            .share-content {
                background: #111;
                border: 1px solid #333;
                border-radius: 20px;
                padding: 30px;
                width: 90%;
                max-width: 400px;
                text-align: center;
                transform: scale(0.9);
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
                position: relative;
            }

            #share-modal.active .share-content {
                transform: scale(1);
            }

            .share-icon-large {
                width: 60px;
                height: 60px;
                background: rgba(0, 255, 136, 0.1);
                border-radius: 50%;
                color: #00ff88;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 20px auto;
                border: 1px solid rgba(0, 255, 136, 0.3);
            }

            .share-input-group {
                display: flex;
                gap: 8px;
                margin-top: 20px;
                background: #0a0a0a;
                padding: 4px;
                border: 1px solid #333;
                border-radius: 10px;
            }

            .share-url-input {
                background: transparent;
                border: none;
                color: #888;
                padding: 10px;
                width: 100%;
                font-size: 13px;
                outline: none;
                font-family: monospace;
            }

            .share-copy-btn-inner {
                background: #222;
                color: #fff;
                border: 1px solid #333;
                padding: 8px 15px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 600;
                transition: all 0.2s ease;
                white-space: nowrap;
            }

            .share-copy-btn-inner:hover {
                background: #00ff88;
                color: #000;
                border-color: #00ff88;
            }

            .share-close-modal {
                position: absolute;
                top: 15px;
                right: 15px;
                background: none;
                border: none;
                color: #666;
                cursor: pointer;
                font-size: 20px;
            }
            .share-close-modal:hover { color: #fff; }



            .share-view-wrapper {
                height: 0;
                overflow: hidden;
                transition: height 0.3s ease;
            }

            .share-view-wrapper.open {
                height: 40px;
                margin-top: 15px;
            }

            .share-view-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                color: #00ff88;
                text-decoration: none;
                font-size: 14px;
                font-weight: 600;
                opacity: 0;
                transform: translateY(20px); 
                transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                cursor: pointer;
                width: fit-content;
                margin: 0 auto;
                padding: 8px 16px;
                border-radius: 20px;
                background: rgba(0, 255, 136, 0.05);
                border: 1px solid transparent;
            }

            .share-view-btn.visible {
                opacity: 1;
                transform: translateY(0);
            }

            .share-view-btn:hover {
                background: rgba(0, 255, 136, 0.15);
                border-color: rgba(0, 255, 136, 0.3);
                transform: scale(1.05);
            }

            .lightbox-copy-btn {
                position: absolute !important;
                bottom: 10px !important;
                left: 10px !important;
                width: 40px;
                height: 40px;
                border-radius: 12px;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #fff;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 30;
                transition: all 0.2s ease;
                margin: 0 !important;
            }

            .lightbox-copy-btn:hover {
                background: #00ff88;
                color: #000;
                border-color: #00ff88;
                transform: scale(1.1);
            }

            @media (max-width: 768px) {
                .lightbox-download-btn {
                    position: static !important;
                    width: 100% !important;
                    margin-top: 15px !important;
                    text-align: center;
                }
                
                .lightbox-visual-area {
                    width: 100%; 
                    text-align: center; 
                }
                
                .lightbox-image {
                    max-width: 100%;
                    height: auto;
                }
            }

            .lightbox-download-btn:hover {
                background: #00ff88;
                color: #000;
                border-color: #00ff88;
            }
        
            .lightbox-details {
                margin-top: 20px;
                text-align: center;
                color: #ccc;
                width: 100%;
                max-width: 600px;
            }
        
            .lightbox-prompt {
                font-size: 15px;
                line-height: 1.5;
                margin-bottom: 8px;
                margin-inline: 1%;
                color: #fff;
                font-weight: 500;
                text-align: center;
            }
        
            .lightbox-meta {
                font-size: 12px;
                color: #00ff88;
                text-transform: uppercase;
                letter-spacing: 1px;
                line-height: 1.6;
            }
        
            .meta-date {
                opacity: 0.7;
                font-size: 0.9em;
                display: block;
                margin-top: 4px;
                color: #fff;
                text-transform: none;
            }
        
            .features-container {
                display: flex;
                gap: 8px;
                justify-content: center;
                flex-wrap: wrap;
                margin-top: 10px;
                margin-bottom: 7px;
            }
        
            .feat-badge {
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 6px;
                padding: 4px 8px;
                font-size: 11px;
                color: #ccc;
                display: flex;
                align-items: center;
                gap: 4px;
                transition: all 0.2s ease;
            }
        
            .feat-badge:hover {
                border-color: rgb(var(--primary-rgb));
                color: rgb(var(--primary-rgb));
                background: rgba(var(--primary-rgb), 0.1);
                cursor: default;
            }
        
            ::-webkit-scrollbar {
                width: 6px;
            }
        
            ::-webkit-scrollbar-track {
                background: #0a0a0a;
            }
        
            ::-webkit-scrollbar-thumb {
                background: #222;
                border-radius: 10px;
            }
        
            ::-webkit-scrollbar-thumb:hover {
                background: #333;
            }
        
            .loading-spinner {
                display: inline-block;
                width: 16px;
                height: 16px;
                border: 2px solid rgba(255, 255, 255, 0.2);
                border-top-color: rgba(var(--primary-rgb), 1);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-left: 8px;
                vertical-align: middle;
            }
        
            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }
        
            .model-skeleton {
                height: 80px;
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 8px;
                animation: skeleton-pulse 1.5s ease-in-out infinite;
            }
        
            @keyframes skeleton-pulse {
        
                0%,
                100% {
                    opacity: 1;
                }
        
                50% {
                    opacity: 0.5;
                }
            }
        
            .confirm-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                z-index: 20000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
        
            .confirm-modal.active {
                opacity: 1;
                visibility: visible;
            }
        
            .confirm-content {
                background: #111;
                border: 1px solid rgba(var(--primary-rgb), 0.5); 
                border-radius: 24px;
                padding: 30px;
                width: 90%;
                max-width: 340px;
                text-align: center;
                transform: scale(0.9) translateY(20px);
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 30px rgba(var(--primary-rgb), 0.1);
            }
        
            .confirm-modal.active .confirm-content {
                transform: scale(1) translateY(0);
            }
        
            .confirm-icon {
                width: 60px;
                height: 60px;
                background: rgba(255, 68, 68, 0.1);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 20px auto;
                color: #ff4444;
            }
        
            .confirm-content h3 {
                color: #fff;
                font-size: 20px;
                margin-bottom: 10px;
                font-weight: 700;
            }
        
            .confirm-content p {
                color: #888;
                font-size: 14px;
                line-height: 1.5;
                margin-bottom: 25px;
            }
        
            .confirm-actions {
                display: flex;
                gap: 12px;
            }
        
            .confirm-actions button {
                flex: 1;
                padding: 12px;
                border-radius: 12px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
                border: 1px solid transparent;
            }
        
            #btn-cancel {
                background: #1a1a1a;
                color: #fff;
                border-color: #333;
            }
        
            #btn-cancel:hover {
                background: #252525;
                border-color: #555;
            }
        
            #btn-confirm {
                background: rgba(255, 68, 68, 0.1);
                color: #ff4444;
                border-color: rgba(255, 68, 68, 0.3);
            }
        
            #btn-confirm:hover {
                background: #ff4444;
                color: #fff;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
            }
        
            .notification.busy-alert {
                top: 90px;
                border-color: #ffaa00;
                animation: slideIn 0.4s ease;
                z-index: 50001 !important;
            }
        
            .notification.busy-alert .notification-spinner {
                border-top-color: #ffaa00;
            }
        
            .top-nav {
                position: absolute;
                top: 15px;
                right: auto;  
                left: 50%;
                display: flex;
                transform: translateX(-50%);
                gap: 10px;
                width: max-content;
                z-index: 100;
            }

        
            .nav-btn {
                background: rgba(10, 10, 10, 0.8);
                border: 1px solid rgba(var(--primary-rgb), 0.5);
                color: #888;
                width: 40px;
                height: 40px;
                border-radius: 12px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                backdrop-filter: blur(5px);
            }
        
            .nav-btn:hover {
                border-color: #00ff88;
                color: #00ff88;
                transform: translateY(-2px);
                box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
            }
        
            .nav-btn svg {
                width: 20px;
                height: 20px;
            }
        
            #redirect-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(5px);
                z-index: 20000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
        
            #redirect-modal.active {
                opacity: 1;
                visibility: visible;
            }
            
            .redirect-content {
                background: #111;
                border: 1px solid rgba(var(--primary-rgb), 0.5);
                border-radius: 20px;
                padding: 30px;
                width: 90%;
                max-width: 350px;
                text-align: center;
                transform: scale(0.9);
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            }
        
            #btn-close-settings:hover {
                transform: scale(1.05) !important;
                background: #333 !important;
            }

            #redirect-modal.active .redirect-content {
                transform: scale(1);
            }
        
            .redirect-icon {
                width: 60px;
                height: 60px;
                background: rgba(var(--primary-rgb), 0.1);
                border-radius: 50%;
                color: rgba(var(--primary-rgb), 1);
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 20px auto;
                border: 1px solid rgba(var(--primary-rgb), 0.3);
            }
        
            .redirect-actions {
                display: flex;
                gap: 10px;
                margin-top: 25px;
            }
        
            .redirect-btn {
                flex: 1;
                padding: 12px;
                border-radius: 10px;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                border: none;
                transition: all 0.2s ease;
            }
        
            .btn-go {
                background: rgba(var(--primary-rgb), 1);
                color: #000;
            }
        
            .btn-go:hover {
                box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.3);
                transform: scale(1.05);
            }
        
            .btn-stay {
                background: #222;
                color: #fff;
                border: 1px solid #333;
            }
        
            .btn-stay:hover {
                background: #333;
            }
        
            #gallery-loader {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: #0a0a0a;
                z-index: 50;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                transition: opacity 0.5s ease, visibility 0.5s ease;
            }
        
            #gallery-loader.hidden {
                opacity: 0;
                visibility: hidden;
                pointer-events: none;
            }
        
            .loader-text {
                color: #fff;
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 15px;
                letter-spacing: 1px;
            }
        
            .loader-track {
                width: 250px;
                height: 4px;
                background: #222;
                border-radius: 10px;
                overflow: hidden;
                position: relative;
            }
        
            #gallery-progress-bar {
                height: 100%;
                width: 0%;
                background: rgb(var(--primary-rgb));
                border-radius: 10px;
                transition: width 0.1s linear;
                box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.5);
            }
        
            #loader-status {
                color: #666;
                font-size: 12px;
                margin-top: 10px;
                font-family: monospace;
            }
        
            .gallery-grid.visible {
                opacity: 1;
            }
        
            .gallery-item.placeholder {
                border: 1px solid rgba(var(--primary-rgb), 0.3);
                background: linear-gradient(135deg, #0a0a0a 0%, #111 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                position: relative;
                overflow: hidden;
                cursor: default;
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.05) inset;
                animation: placeholderPulse 2s infinite ease-in-out;
                opacity: 1 !important;
                transform: scale(1) !important;
            }
        
            @keyframes placeholderPulse {
                0% {
                    border-color: var(--placeholderPulse-0-border);
                    box-shadow: 0 0 10px var(--placeholderPulse-0-box-shadow) inset;
                }
        
                50% {
                    border-color: var(--placeholderPulse-50-border);
                    box-shadow: 0 0 30px var(--placeholderPulse-50-box-shadow) inset;
                }
        
                100% {
                    border-color: var(--placeholderPulse-100-border);
                    box-shadow: 0 0 10px var(--placeholderPulse-100-box-shadow) inset;
                }
            }

            .placeholder-loader {
                width: 40px;
                height: 40px;
                border: 3px solid rgba(var(--primary-rgb), 0.1);
                border-top-color: rgba(var(--primary-rgb), 1);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                z-index: 5;
            }
        
            .magic-star {
                position: absolute;
                width: 0;
                height: 0;
                fill: rgb(var(--primary-rgb));
                opacity: 0;
                animation: twinkle 3s infinite ease-in-out;
            }
        
            .magic-star:nth-child(1) {
                top: 20%;
                left: 20%;
                animation-delay: 0s;
                width: 10px;
                height: 10px;
            }
        
            .magic-star:nth-child(2) {
                top: 70%;
                left: 80%;
                animation-delay: 0.5s;
                width: 8px;
                height: 8px;
            }
        
            .magic-star:nth-child(3) {
                top: 40%;
                left: 60%;
                animation-delay: 1.0s;
                width: 6px;
                height: 6px;
            }
        
            .magic-star:nth-child(4) {
                top: 80%;
                left: 15%;
                animation-delay: 1.5s;
                width: 12px;
                height: 12px;
            }
        
            .magic-star:nth-child(5) {
                top: 10%;
                left: 90%;
                animation-delay: 2.0s;
                width: 7px;
                height: 7px;
            }
        
            @keyframes twinkle {
                0% {
                    transform: scale(0) rotate(0deg);
                    opacity: 0;
                }
        
                50% {
                    transform: scale(1) rotate(180deg);
                    opacity: 1;
                    text-shadow: 0 0 10px rgb(var(--primary-rgb));
                }
        
                100% {
                    transform: scale(0) rotate(360deg);
                    opacity: 0;
                }
            }
        
            .placeholder-text {
                position: absolute;
                bottom: 20px;
                font-size: 12px;
                color: rgba(var(--primary-rgb), 1);
                font-weight: 600;
                letter-spacing: 1px;
                text-transform: uppercase;
                animation: pulseText 2s infinite;
            }
        
            @keyframes pulseText {
        
                0%,
                100% {
                    opacity: 0.5;
                }
        
                50% {
                    opacity: 1;
                }
            }
        
        
            .gallery-item.sensitive img {
                filter: blur(20px) brightness(0.8);
                transform: scale(1.2);
                transition: filter 0.3s ease, transform 0.5s ease;
            }

            .gallery-item.sensitive-medium img {
                filter: blur(1px) brightness(0.5);
                transform: scale(1.05);
                transition: filter 0.3s ease, transform 0.5s ease;
            }

            .gallery-item.sensitive::after,
            .gallery-item.sensitive-medium::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 32px;
                z-index: 5;
                opacity: 0.7;
                pointer-events: none;
                text-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            }
        
            .feat-badge.mod-high {
                border-color: rgba(0, 255, 136, 0.3);
                color: #00ff88;
                background: rgba(0, 255, 136, 0.05);
            }
        
            .feat-badge.mod-medium {
                border-color: rgba(255, 170, 0, 0.3);
                color: #ffaa00;
                background: rgba(255, 170, 0, 0.05);
            }
        
            .feat-badge.mod-low {
                border-color: rgba(255, 68, 68, 0.3);
                color: #ff4444;
                background: rgba(255, 68, 68, 0.05);
            }


            @media (max-width: 768px) {
                .lightbox-image-wrapper {
                    display: flex !important;
                    flex-direction: column !important; 
                    align-items: center !important;   
                    justify-content: flex-start !important;
                    height: auto !important;         
                    max-height: none !important;      
                    width: 100% !important;
                    margin-bottom: 10px;
                }

                .lightbox-image {
                    max-height: 55vh !important; 
                    width: auto !important;     
                    max-width: 100% !important;  
                    object-fit: contain;
                    border-radius: 12px;
                }

                .lightbox-download-btn {
                    position: static !important; 
                    margin-top: 15px !important; 
                    width: 100% !important;     
                    text-align: center;
                    justify-content: center;
                    background: rgb(var(--primary-rgb)) !important;
                    color: #000 !important;
                    padding: 12px !important;
                }

                .lightbox-delete-btn {
                    position: absolute !important;
                    top: 10px !important;
                    right: 10px !important;
                    z-index: 20;
                    background: rgba(0, 0, 0, 0.6) !important;
                    border-radius: 50%;
                    width: 36px !important;
                    height: 36px !important;
                }

                .lightbox-content {
                    width: 90% !important;
                    max-height: 90vh !important;
                    padding: 20px !important;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden; 
                }

                .lightbox-details {
                    width: 100%;
                    overflow-y: auto; 
                    max-height: 25vh;
                    margin-top: 10px;
                    padding-right: 5px; 
                }

                .lightbox-prompt {
                    font-size: 14px !important;
                    line-height: 1.4;
                    text-align: center !important;
                }
            }
            .lightbox-visual-area {
                position: relative;
                display: inline-block;
                width: fit-content;
                height: fit-content;
                line-height: 0;
            }

            @media (max-width: 768px) {
                .top-nav {
                    right: auto;       
                    left: 50%;        
                    transform: translateX(-50%);
                    top: 15px;       
                    width: max-content;
                }
            }

            @media (hover: hover) {
                .model-card:hover {
                    transform: scale(1.1);
                }
                .model-card:hover::before {
                    opacity: 1;
                }

                .aspect-btn:hover {
                    transform: scale(1.1);
                }
                .aspect-btn:hover::before {
                    opacity: 1;
                }

                .extra-btn:hover:not(:disabled) {
                    transform: scale(1.05);
                }
                .extra-btn:hover:not(:disabled)::before {
                    opacity: 1;
                }
            }

            :root {
                --primary: #00ff88;
                --primary-rgb: 0, 255, 136;
                --theme-bg: #00ff88;
                --dot-filled-1: rgba(224, 224, 224, 0.2);
                --dot-filled-2: rgba(162, 210, 255, 0.4);
                --dot-filled-3: rgba(96, 165, 250, 0.6);
                --dot-filled-4: rgba(59, 130, 246, 0.8);
                --dot-filled-5: rgba(29, 78, 216, 1);
                --placeholderPulse-0-border: #00ff881a;
                --placeholderPulse-0-box-shadow: #00ff880d;
                --placeholderPulse-50-border: #00ff8899;
                --placeholderPulse-50-box-shadow: #00ff8833;
                --placeholderPulse-100-border: #00ff881a;
                --placeholderPulse-100-box-shadow: #00ff880d;
            }

            .glitch-text { text-shadow: 0 0 20px var(--primary), 0 0 40px var(--primary) !important; }
            .progress-bar { background: var(--theme-bg) !important; }
            .api-link-btn { color: var(--primary) !important; border-color: rgba(var(--primary-rgb), 0.3) !important; background: rgba(var(--primary-rgb), 0.05) !important; }
            .api-link-btn:hover { background: rgba(var(--primary-rgb), 0.15) !important; border-color: var(--primary) !important; box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.2) !important; }
            textarea:focus, .search-input:focus, #api-key:focus { border-color: var(--primary) !important; }
            #api-key.decrypt-effect { color: var(--primary) !important; }
            .model-info-icon-wrapper:hover { color: var(--primary) !important; background: rgba(var(--primary-rgb), 0.15) !important; border-color: var(--primary) !important; }
            .model-card.active { border-color: var(--primary) !important; background: rgba(var(--primary-rgb), 0.05) !important; }
            .model-card.active .model-name { color: var(--primary) !important; text-shadow: 0 0 15px rgba(var(--primary-rgb), 0.8) !important; }
            .aspect-btn.active, .extra-btn.active { background: rgba(var(--primary-rgb), 0.05) !important; border-color: var(--primary) !important; color: var(--primary) !important; }
            .generate-btn.ready { background: rgba(var(--primary-rgb), 0.05) !important; border-color: var(--primary) !important; color: var(--primary) !important; box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.1) !important; }
            .gallery-btn:hover, .nav-btn:hover { border-color: var(--primary) !important; color: var(--primary) !important; }
            .gallery-title, .info-meta, .lightbox-meta { color: var(--primary) !important; }
            #gallery-progress-bar { background: var(--primary) !important; box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.5) !important; }
            .control-btn:hover, .control-btn.active { border-color: var(--primary) !important; color: var(--primary) !important; background: rgba(var(--primary-rgb), 0.05) !important; }
            .lightbox-share-btn:hover, .lightbox-copy-btn:hover { background: var(--primary) !important; color: #000 !important; border-color: var(--primary) !important; }
            .lightbox-download-btn:hover { background: var(--primary) !important; color: #000 !important; border-color: var(--primary) !important; scale: 1.05 !important; }
            .share-icon-large { color: var(--primary) !important; background: rgba(var(--primary-rgb), 0.1) !important; border-color: rgba(var(--primary-rgb), 0.3) !important; }
            .share-copy-btn-inner:hover { background: var(--primary) !important; color: #000 !important; border-color: var(--primary) !important; }
            .share-view-btn { color: var(--primary) !important; background: rgba(var(--primary-rgb), 0.05) !important; }
            .share-view-btn:hover { background: rgba(var(--primary-rgb), 0.15) !important; border-color: rgba(var(--primary-rgb), 0.3) !important; }

            .theme-btn {
                width: 40px; 
                height: 40px; 
                border-radius: 50%; 
                border: 2px solid #333;
                cursor: pointer; 
                transition: transform 0.2s, border-color 0.2s;
                background-size: cover;
            }
            .theme-btn:hover { transform: scale(1.1); }
            .theme-btn.active { border-color: #fff; box-shadow: 0 0 15px currentColor; transform: scale(1.1); }
            #btn-hard-reset:hover { background: #ff4444 !important; color: #fff !important; }
                


            .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
            }

            .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
            }

            .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
            }

            .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
            }

            input:checked + .slider {
            background-color: var(--primary);
            }

            input:focus + .slider {
            box-shadow: 0 0 1px var(--primary);
            }

            input:checked + .slider:before {
            -webkit-transform: translateX(18px);
            -ms-transform: translateX(18px);
            transform: translateX(18px);
            }

            body.performance-mode * {
                transition: none !important;
                animation: none !important;
                box-shadow: none !important;
                text-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }

            body.performance-mode .glitch-text {
                animation: none !important;
                text-shadow: 0 0 5px var(--primary) !important;
            }

            body.performance-mode .modal-card, 
            body.performance-mode .confirm-content,
            body.performance-mode .gallery-content,
            body.performance-mode .lightbox-content {
                background: #111 !important;
                border: 1px solid #333 !important;
            }

            body.performance-mode .gallery-item {
                opacity: 1 !important;
                transform: none !important;
                filter: none !important;
                animation: none !important;
            }

            body.performance-mode .placeholder {
                opacity: 1 !important;
            }

            body.performance-mode .feat-desc {
                filter: none !important;
            }

            body.performance-mode .confetti {
                display: none !important;
            }

            body.performance-mode .magic-star {
                display: none !important;
            }

            .showcase-mode {
                align-items: center !important;
            }

            .showcase-content-wrapper {
                width: 80% !important;
                max-width: 1600px !important;
                height: 85vh !important;
                border-radius: 24px !important;
                transform: scale(0.95);
                opacity: 0;
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
                background: rgba(15, 15, 15, 0.8) !important;
                border: 1px solid rgba(var(--primary-rgb), 0.3) !important;
            }

            .showcase-mode.active .showcase-content-wrapper {
                transform: scale(1);
                opacity: 1;
            }

            #showcase-loader {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 40px;
            }

            #showcase-loader.hidden {
                display: none;
            }

            .gallery-item {
                pointer-events: auto;
            }

            @media (max-width: 768px) {
                .showcase-content-wrapper {
                    width: 95% !important;
                    height: 90vh !important;
                }
                .search-container[style*="flex: 0 0 200px"] {
                    flex: 1 !important;
                    min-width: 150px;
                }
            }


            #img2prompt-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(10, 10, 10, 0.8);
                border: 1px solid #333;
                color: #888;
                width: 32px;
                height: 32px;
                border-radius: 6px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                backdrop-filter: blur(4px);
                z-index: 10;
            }

            #img2prompt-btn:hover {
                border-color: rgba(var(--primary-rgb), 0.5);
                color: rgb(var(--primary-rgb));
                background: rgba(var(--primary-rgb), 0.1);
                transform: scale(1.05);
            }

            .upload-area {
                border: 2px dashed rgb(var(--primary-rgb));
                border-radius: 12px;
                padding: 20px;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                background: #0f0f0f;
                position: relative;
                min-height: 150px;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
            }

            .upload-area:hover, .upload-area.dragover {
                border-color: rgba(var(--primary-rgb), 0.5);
                background: rgba(var(--primary-rgb), 0.05);
            }

            .upload-area span {
                color: #666;
                font-size: 14px;
                font-weight: 500;
            }

            #preview-img {
                max-width: 100%;
                max-height: 200px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.5);
                object-fit: contain;
            }

            #preview-img.hidden, #clear-img-btn.hidden {
                display: none;
            }

            #upload-placeholder.hidden {
                display: none;
            }

            #clear-img-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 24px;
                height: 24px;
                background: rgba(0,0,0,0.8);
                color: #fff;
                border: 1px solid #444;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                transition: all 0.2s;
            }

            #clear-img-btn:hover {
                background: #ff4444;
                border-color: #ff4444;
            }

            .generate-btn-small {
                background: rgba(var(--primary-rgb), 0.1);
                color: rgb(var(--primary-rgb));
                border: 1px solid rgba(var(--primary-rgb), 0.3);
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                font-weight: 600;
                transition: all 0.3s ease;
            }

            .generate-btn-small:hover:not(:disabled) {
                background: rgb(var(--primary-rgb));
                color: #000;
                box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.4);
            }

            #btn-img2prompt-cancel {
                background: #1a1a1a !important;
                color: #fff !important;
                border: 1px solid #333 !important;
            }

            #btn-img2prompt-cancel:hover {
                background: #333 !important;
                transform: scale(1.05) !important;
            }

            .generate-btn-small:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                filter: grayscale(1);
                background: #1a1a1a;
                border-color: #333;
                color: #666;
            }

            .sparkle-icon {
                transition: transform 0.3s ease;
            }

            .generate-btn-small:hover .sparkle-icon {
                transform: rotate(15deg) scale(1.2);
            }

            .generate-btn-small.loading svg {
                animation: spin 1s linear infinite;
            }

        </style>
    </head>
    <body>
        <div id="loading-screen">
            <div class="glitch-text">THENA</div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>
        <div id="app">
            <div class="top-nav">
                <button class="nav-btn" id="btn-donate" title="Buy us a coffee">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                        <line x1="6" y1="1" x2="6" y2="4"></line>
                        <line x1="10" y1="1" x2="10" y2="4"></line>
                        <line x1="14" y1="1" x2="14" y2="4"></line>
                    </svg>
                </button>
                <button class="nav-btn" id="btn-showcase" title="Community Showcase">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </button>
                <button class="nav-btn" id="btn-open-bot" title="Telegram Bot">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
                <button class="nav-btn" id="btn-open-owner" title="Developer">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </button>
                <button class="nav-btn" id="btn-open-settings" title="Settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>
            <div class="background-text">THENA</div>
            <div class="container">
                <div class="input-group">
                    <label> API Key <a href="https://t.me/ThenaAIBot?start=refAPI" target="_blank" class="api-link-btn"> Get Your Free API Key <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                        </a>
                    </label>
                    <div style="position: relative;">
                        <input type="password" id="api-key" placeholder="Enter your Thena API key..." style="width: 100%; background: #0a0a0a; border: 1px solid #222; border-radius: 8px; padding: 14px 45px 14px 14px; color: #fff; font-size: 15px; outline: none;" />
                        <button id="toggle-api-key" aria-label="Toggle API key visibility">
                            <svg id="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path id="eye-path" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle id="eye-circle" cx="12" cy="12" r="3"></circle>
                                <line id="eye-slash" x1="3" y1="3" x2="21" y2="21" stroke-width="2" opacity="0"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="input-group">
    <label>Prompt</label>
    <div style="position: relative;">
        <textarea id="prompt" maxlength="1150" placeholder="Describe your image... (Min 10 chars, Max 1150 chars)" style="padding-right: 90px;"></textarea>
        
        <button id="img2prompt-btn" title="Image to Prompt">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
        </button>

        <button id="moderation-btn" title="Moderation: High" data-level="high">
            <svg class="mod-icon icon-high" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            <svg class="mod-icon icon-medium" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <svg class="mod-icon icon-low" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.1.8-2.2 1.5-3.1v-.1z"></path>
            </svg>
        </button>

        <button id="magic-wand-btn" title="Enhance Prompt" style="border-color: rgba(0, 255, 136, 0.3);">
            <svg fill="#26d96b" width="64px" height="64px" viewBox="0 0 64.00 64.00" xmlns="http://www.w3.org/2000/svg" stroke="#26d96b" stroke-width="0.00064">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.384"></g>
                <g id="SVGRepo_iconCarrier">
                    <g data-name="Magic Wand" id="Magic_Wand">
                        <path d="M10.89,57a3.89,3.89,0,0,0,2.76-1.14l26.7-26.7.26.78a3,3,0,0,0,1.07,1.45,3,3,0,0,0,4.13-.66l3-4.13,5.28-.05A2.86,2.86,0,0,0,55.82,26a2.93,2.93,0,0,0,.6-4.1l-3.09-4.15,1.66-5h0a3,3,0,0,0,0-1.83,2.9,2.9,0,0,0-1.46-1.69A3,3,0,0,0,51.31,9l-5,1.66L42.13,7.58A3,3,0,0,0,40.4,7h0a2.92,2.92,0,0,0-2.93,2.91l0,5.28-4.14,3a3,3,0,0,0,.79,5.2l.78.26L8.14,50.35A3.9,3.9,0,0,0,10.89,57ZM32.13,32.5a1,1,0,0,0-.63-.63L30,31.36,32.3,29l2,.67.67,2L32.64,34Zm2-11.49a1,1,0,0,1,0-.73.9.9,0,0,1,.34-.47L39,16.52a1,1,0,0,0,.41-.81l.05-5.79a.9.9,0,0,1,.28-.65A.91.91,0,0,1,40.38,9a.84.84,0,0,1,.55.19l4.58,3.39a1,1,0,0,0,.91.15l5.52-1.82a.91.91,0,0,1,1.15.58,1,1,0,0,1,0,.58l-1.82,5.51a1,1,0,0,0,.15.91l3.39,4.58a.94.94,0,0,1,.18.69,1,1,0,0,1-.37.61.9.9,0,0,1-.54.18l-5.79.05a1,1,0,0,0-.81.41l-3.29,4.55a1,1,0,0,1-1.33.21.9.9,0,0,1-.35-.47L40.7,23.93a1,1,0,0,0-.63-.63L34.7,21.49A.93.93,0,0,1,34.15,21ZM39,25l.68,2-3.09,3.09L36,28.59a1,1,0,0,0-.63-.62l-1.54-.52L37,24.36ZM9.56,51.77,28.39,32.94l2,.67.67,2L12.23,54.45a1.89,1.89,0,1,1-2.67-2.68Z"></path>
                        <path d="M26,16.79c-.45-.79-1.38-.74-2.79-.66a9.44,9.44,0,0,1-5.68-1.52c-1.18-.77-2-1.28-2.75-.83s-.74,1.39-.66,2.79a9.39,9.39,0,0,1-1.52,5.69c-.77,1.18-1.28,1.95-.82,2.74s1.37.74,2.79.66a9.45,9.45,0,0,1,5.68,1.53c.93.6,1.88,1.32,2.75.82s.74-1.39.65-2.79a9.43,9.43,0,0,1,1.53-5.68C25.92,18.36,26.43,17.58,26,16.79Zm-2.49,1.65a11.43,11.43,0,0,0-1.85,6.9c0,.11,0,.24,0,.39l-.33-.22a11.5,11.5,0,0,0-6.26-1.86c-.21,0-.43,0-.64,0l-.39,0,.21-.33a11.47,11.47,0,0,0,1.85-6.9c0-.11,0-.25,0-.39l.33.21a11.47,11.47,0,0,0,6.9,1.85l.39,0Z"></path>
                        <path d="M55.06,36.42c-.6-.6-1.36-.35-2.41,0a6.84,6.84,0,0,1-4.29,0c-1.06-.35-1.82-.6-2.42,0s-.34,1.35,0,2.41a6.84,6.84,0,0,1,0,4.29c-.35,1.05-.6,1.81,0,2.41a1.18,1.18,0,0,0,.89.36,5.32,5.32,0,0,0,1.53-.37,7,7,0,0,1,4.29,0c1.05.35,1.81.6,2.41,0s.34-1.36,0-2.41a6.84,6.84,0,0,1,0-4.29C55.4,37.77,55.65,37,55.06,36.42Zm-2,7.15a8.83,8.83,0,0,0-5.19,0,9,9,0,0,0,0-5.19,9,9,0,0,0,5.19,0A8.83,8.83,0,0,0,53.1,43.57Z"></path>
                        <path d="M36.6,44.21a6.93,6.93,0,0,1-3.7-2.14c-.74-.83-1.27-1.43-2.08-1.21s-1,1-1.2,2.09a6.93,6.93,0,0,1-2.14,3.7c-.83.74-1.43,1.27-1.21,2.08s1,1,2.09,1.21a6.82,6.82,0,0,1,3.7,2.13c.64.72,1.24,1.44,2.09,1.21s1-1,1.2-2.09a6.85,6.85,0,0,1,2.13-3.7c.83-.74,1.43-1.27,1.21-2.08S37.69,44.43,36.6,44.21ZM33.43,50.6A8.88,8.88,0,0,0,29,48a9,9,0,0,0,2.59-4.48A8.85,8.85,0,0,0,36,46.12,8.92,8.92,0,0,0,33.43,50.6Z"></path>
                    </g>
                </g>
            </svg>
        </button>
    </div>
</div>
                <div class="input-group">
                    <label>Model</label>
                    <div class="model-selector" id="model-selector">
                        <div class="model-skeleton"></div>
                        <div class="model-skeleton"></div>
                        <div class="model-skeleton"></div>
                    </div>
                </div>
                <div class="input-group">
                    <label>Aspect Ratio</label>
                    <div class="aspect-ratio-selector">
                        <button class="aspect-btn" data-ratio="1:1" data-size="1024x1024">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span> 1:1 </button>
                        <button class="aspect-btn" data-ratio="3:4" data-size="768x1024">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span> 3:4 </button>
                        <button class="aspect-btn" data-ratio="4:3" data-size="1024x768">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span> 4:3 </button>
                        <button class="aspect-btn" data-ratio="9:16" data-size="576x1024">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span> 9:16 </button>
                        <button class="aspect-btn" data-ratio="16:9" data-size="1024x576">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span> 16:9 </button>
                    </div>
                </div>
                <div class="input-group">
                    <label>Extra Features</label>
                    <div class="extras-selector">
                        <button class="extra-btn active" id="feat-fast" data-feat="fastMode">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span>
                            <span></span> Fast Mode </button>
                        <button class="extra-btn" id="feat-creative" data-feat="creative">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span>
                            <span></span> Creative </button>
                        <button class="extra-btn" id="feat-dense" data-feat="denseMode">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span>
                            <span></span> Dense </button>
                        <button class="extra-btn" id="feat-movie" data-feat="movieFilter" disabled>
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span>
                            <span></span> Movie Filter </button>
                        <button class="extra-btn" id="feat-highres" data-feat="highRes">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span>
                            <span></span> HighRes </button>
                        <button class="extra-btn" id="feat-enhance" data-feat="enhance">
                            <span class="info-icon-wrapper" title="Info">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </span>
                            <span></span> Prompt Magic
                        </button>
                    </div>
                </div>
                <button class="generate-btn" id="generate-btn">Generate Image</button>
            </div>
            <button class="gallery-btn" id="gallery-btn">Gallery</button>
        </div>
        <div class="gallery-modal" id="gallery-modal">
            <div class="gallery-content">
                <div class="modal-handle"></div>
                <div class="gallery-header">
                    <h2 class="gallery-title">Gallery</h2>
                    <button class="close-btn" id="close-gallery" style="margin-left: auto;">&times;</button>
                </div>
                <div class="gallery-controls">
                    <div class="search-container">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="search-input" class="search-input" placeholder="Search prompts...">
                    </div>
                    <button class="control-btn" id="toggle-filter-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                        </svg> Filter </button>
                    <button class="control-btn" id="toggle-sort-btn">
                        <svg id="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <polyline points="19 12 12 19 5 12"></polyline>
                        </svg>
                        <span id="sort-text">Newest</span>
                    </button>
                    <button class="control-btn" id="delete-all-btn" style="color: #ff4444; border-color: rgba(255, 68, 68, 0.3);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg> Delete All </button>
                </div>
                <div class="filter-panel" id="filter-panel">
                    <div class="filter-group">
                        <label class="filter-label">Model</label>
                        <select id="filter-model" class="filter-select">
                            <option value="">All Models</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ratio / Size</label>
                        <select id="filter-ratio" class="filter-select">
                            <option value="">All Sizes</option>
                            <option value="1024x1024">1:1 (Square)</option>
                            <option value="768x1024">3:4 (Portrait)</option>
                            <option value="1024x768">4:3 (Landscape)</option>
                            <option value="576x1024">9:16 (Mobile)</option>
                            <option value="1024x576">16:9 (Cinematic)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Start Date</label>
                        <input type="date" id="filter-date-start" class="filter-date">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">End Date</label>
                        <input type="date" id="filter-date-end" class="filter-date">
                    </div>
                    <div class="reset-filters-btn" id="reset-filters"> Reset All Filters </div>
                </div>
                <div id="gallery-loader">
                    <div class="loader-text">Galeri Ykleniyor...</div>
                    <div class="loader-track">
                        <div id="gallery-progress-bar"></div>
                    </div>
                    <div id="loader-status">0%</div>
                </div>
                <div class="gallery-grid" id="gallery-grid">
                    <div class="empty-gallery">No images yet. Start generating!</div>
                </div>
            </div>
        </div>
        <div id="lightbox">
            <div class="lightbox-content">
                <div class="lightbox-image-wrapper">
                    <div class="lightbox-visual-area">
                        <button class="lightbox-close-btn" id="lightbox-close" title="Close">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>

                        <button class="lightbox-delete-btn" id="lightbox-delete" title="Delete Image">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        </button>

                        <button class="lightbox-copy-btn" id="lightbox-copy-btn" title="Copy Settings">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>

                        <button class="lightbox-share-btn" id="lightbox-share-btn" title="Share Image">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                        </button>

                        <img src="" alt="" class="lightbox-image" id="lightbox-img">
                    </div>
                    
                    <a href="#" class="lightbox-download-btn" id="lightbox-download" download="thena-image.png">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                        Download
                    </a>
                </div>
                
                <div class="lightbox-details">
                    <div class="lightbox-prompt" id="lightbox-prompt"></div>
                    <div class="lightbox-meta" id="lightbox-meta"></div>
                </div>
            </div>
        </div>
        <div id="confirm-modal" class="confirm-modal">
            <div class="confirm-content">
                <div class="confirm-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 6h18"></path>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </div>
                <h3>Delete the image?</h3>
                <p>Are you sure you want to permanently delete this image? This action is irreversible.</p>
                <div class="confirm-actions">
                    <button id="btn-cancel">Cancel</button>
                    <button id="btn-confirm">Yes, Delete</button>
                </div>
            </div>
        </div>
        <div id="delete-all-modal" class="confirm-modal">
            <div class="confirm-content">
                <div class="confirm-icon" style="background: rgba(255, 0, 0, 0.1); color: #ff0000;">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>
                <h3 style="color: #ff4444;">Delete All Gallery Images?</h3>
                <p>All images in the gallery will be permanently deleted. This action is irreversible. Do you want to proceed?</p>
                <div class="confirm-actions">
                    <button id="btn-cancel-all" style="background: #1a1a1a; color: #fff; border: 1px solid #333;">Cancel</button>
                    <button id="btn-confirm-all" style="background: #ff4444; color: #fff; border: none; box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);">Yes, Delete All</button>
                </div>
            </div>
        </div>
        <div id="hard-reset-modal" class="confirm-modal" style="z-index: 99999999 !important;">
            <div class="confirm-content">
                <div class="confirm-icon" style="background: rgba(255, 0, 0, 0.1); color: #ff0000;">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                        <line x1="12" y1="2" x2="12" y2="12"></line>
                    </svg>
                </div>
                <h3 style="color: #ff4444;">Reset Application</h3>
                <p>This action will permanently delete ALL images in your gallery, your API key, and all settings. This action is irreversible.</p>
                <div class="confirm-actions">
                    <button id="btn-cancel-reset" style="background: #1a1a1a; color: #fff; border: 1px solid #333;">Cancel</button>
                    <button id="btn-confirm-reset" style="background: #ff4444; color: #fff; border: none; box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);">Yes, Delete Everything</button>
                </div>
            </div>
        </div>
        <div id="redirect-modal">
            <div class="redirect-content">
                <div class="redirect-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                </div>
                <h3 id="redirect-title" style="color:#fff; margin-bottom:10px;">Redirecting...</h3>
                <p id="redirect-desc" style="color:#888; font-size:14px; margin-bottom:20px;">You are about to go to the Telegram bot.</p>
                <div class="redirect-actions">
                    <button class="redirect-btn btn-stay" id="btn-redirect-cancel">Cancel</button>
                    <button class="redirect-btn btn-go" id="btn-redirect-confirm">Go</button>
                </div>
            </div>
        </div>
        <div id="share-modal">
            <div class="share-content">
                <button class="share-close-modal" id="btn-share-close">&times;</button>
                <div class="share-icon-large">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                        <polyline points="16 6 12 2 8 6"></polyline>
                        <line x1="12" y1="2" x2="12" y2="15"></line>
                    </svg>
                </div>
                <h3 style="color:#fff; margin-bottom:10px;">Public Share Link</h3>
                <p style="color:#888; font-size:14px; line-height:1.5;">
                    Your image is now publicly accessible via this link. Anyone with this URL can view the image.
                </p>
                
                <div class="share-input-group">
                    <input type="text" class="share-url-input" id="share-url-display" readonly value="Generating link...">
                    <button class="share-copy-btn-inner" id="btn-share-copy">Copy</button>
                </div>

                <div class="share-view-wrapper" id="share-view-wrapper">
                    <a href="#" target="_blank" class="share-view-btn" id="btn-share-view">
                        <span>View Image</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                    </a>
                </div>
                </div>
        </div>

        <div id="settings-modal" class="confirm-modal">
            <div class="confirm-content settings-content" style="max-width: 400px;">
                <div class="confirm-icon" style="background: rgba(255, 255, 255, 0.1); color: rgba(var(--primary-rgb), 1);">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </div>
                <h3 style="color: #fff; margin-bottom: 20px;">Settings</h3>
                
                <div class="setting-group" style="margin-bottom: 25px; text-align: left;">
                    <label style="display:block; color:#888; margin-bottom:10px; font-size:13px; font-weight:600;">SOLID COLORS</label>
                    <div class="theme-selector" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                        <button class="theme-btn active" data-color="#00ff88" data-rgb="0, 255, 136" style="background:#00ff88;"></button>
                        <button class="theme-btn" data-color="#00ccff" data-rgb="0, 204, 255" style="background:#00ccff;"></button>
                        <button class="theme-btn" data-color="#ff0088" data-rgb="255, 0, 136" style="background:#ff0088;"></button>
                        <button class="theme-btn" data-color="#ffaa00" data-rgb="255, 170, 0" style="background:#ffaa00;"></button>
                        <button class="theme-btn" data-color="#bd00ff" data-rgb="189, 0, 255" style="background:#bd00ff;"></button>
                    </div>
                </div>

                <div class="setting-group" style="margin-bottom: 25px; text-align: left;">
                    <label style="display:block; color:#888; margin-bottom:10px; font-size:13px; font-weight:600;">GRADIENT THEMES</label>
                    <div class="theme-selector" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                        <button class="theme-btn" 
                            data-color="#bd00ff" 
                            data-rgb="189, 0, 255" 
                            data-gradient="linear-gradient(135deg, #ff0088 0%, #bd00ff 100%)"
                            style="background: linear-gradient(135deg, #ff0088 0%, #bd00ff 100%);">
                        </button>

                        <button class="theme-btn" 
                            data-color="#00ccff" 
                            data-rgb="0, 204, 255" 
                            data-gradient="linear-gradient(135deg, #00ff88 0%, #00ccff 100%)"
                            style="background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);">
                        </button>

                        <button class="theme-btn" 
                            data-color="#ffaa00" 
                            data-rgb="255, 170, 0" 
                            data-gradient="linear-gradient(135deg, #ff4444 0%, #ffaa00 100%)"
                            style="background: linear-gradient(135deg, #ff4444 0%, #ffaa00 100%);">
                        </button>

                        <button class="theme-btn" 
                            data-color="#00ff88" 
                            data-rgb="0, 255, 136" 
                            data-gradient="linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%)"
                            style="background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%);">
                        </button>
                    </div>
                </div>

                <div class="setting-group" style="margin-bottom: 25px; text-align: left;">
                    <label style="display:flex; justify-content:space-between; align-items:center; color:#888; margin-bottom:10px; font-size:13px; font-weight:600;">
                        PERFORMANCE MODE
                        <label class="switch">
                            <input type="checkbox" id="perf-mode-toggle">
                            <span class="slider round"></span>
                        </label>
                    </label>
                    <p style="font-size:12px; color:#666; margin-bottom:10px;">Reduces animations, blur effects and shadows for faster experience.</p>
                </div>


                <div class="setting-group" style="margin-bottom: 25px; text-align: left;">
                    <label style="display:block; color:#888; margin-bottom:10px; font-size:13px; font-weight:600;">DATA MANAGEMENT</label>
                    <p style="font-size:12px; color:#666; margin-bottom:10px;">Clear all local data including API key, settings, and image gallery.</p>
                    <button id="btn-hard-reset" style="width:100%; padding:12px; background:rgba(255,68,68,0.1); color:#ff4444; border:1px solid rgba(255,68,68,0.3); border-radius:8px; cursor:pointer; font-size:13px; font-weight:600; transition:all 0.2s;">
                        Reset Application Data
                    </button>
                </div>

                <button id="btn-close-settings" style="transition: transform 0.2s ease-in-out, background 0.2s ease !important; width:100%; padding:12px; background:#222; color:#fff; border:1px solid #333; border-radius:8px; cursor:pointer; font-weight:600;">Close</button>
            </div>
        </div>

        <div id="showcase-modal" class="gallery-modal showcase-mode">
            <div class="gallery-content showcase-content-wrapper">
                <div class="gallery-header">
                    <h2 class="gallery-title">Community Showcase</h2>
                    <button class="close-btn" id="close-showcase" style="margin-left: auto;">&times;</button>
                </div>
                
                <div class="gallery-controls">
                    <div class="search-container">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="showcase-search" class="search-input" placeholder="Search showcase prompts...">
                    </div>
                    
                    <div class="search-container" style="flex: 0 0 200px;">
                        <select id="showcase-filter-model" class="filter-select" style="height: 100%; border-radius: 12px;">
                            <option value="">All Models</option>
                        </select>
                    </div>
                </div>

                <div id="showcase-loader">
                    <div class="loader-text">Loading Showcase...</div>
                    <div class="loader-track">
                        <div id="showcase-progress-bar" class="progress-bar" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="gallery-grid" id="showcase-grid">
                    </div>
            </div>
        </div>

        <div id="img2prompt-modal" class="confirm-modal">
            <div class="confirm-content" style="max-width: 450px;">
                <h3 style="color: #fff; margin-bottom: 15px;">Image to Prompt</h3>
                <p style="color: #888; font-size: 13px; margin-bottom: 20px;">
                    Upload an image or paste from clipboard (Ctrl+V) to generate a prompt.
                </p>

                <div id="img-upload-area" class="upload-area">
                    <input type="file" id="img-file-input" accept="image/*" hidden>
                    <div id="upload-placeholder">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 10px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <span>Click to Upload or Paste Image</span>
                    </div>
                    <img id="preview-img" class="hidden">
                    <button id="clear-img-btn" class="hidden" title="Remove Image">&times;</button>
                </div>

                <div class="confirm-actions" style="margin-top: 20px;">
                    <button id="btn-img2prompt-cancel">Cancel</button>
                    <button id="btn-img2prompt-generate" class="generate-btn-small" disabled>
                        <span>Generate Prompt</span>
                        <svg class="sparkle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>




        <script>
            const audioCtx = new(window.AudioContext || window.webkitAudioContext)();

            function playTone(type, freqStart, freqEnd, duration, delay = 0, volume = 0.1) {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freqStart, audioCtx.currentTime + delay);
                if (freqEnd) {
                    osc.frequency.exponentialRampToValueAtTime(freqEnd, audioCtx.currentTime + delay + duration);
                }
                gain.gain.setValueAtTime(volume, audioCtx.currentTime + delay);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + delay + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + delay);
                osc.stop(audioCtx.currentTime + delay + duration);
            }

            function playStartSound() {
                playTone('sine', 300, 600, 0.4, 0, 0.7);
            }

            function playErrorSound() {
                playTone('sawtooth', 220, 150, 0.2, 0, 0.4);
                playTone('sawtooth', 140, 100, 0.3, 0.15, 0.4);
            }
            function playModelSelectSound(isActive) {
                if (isActive) {
                    playTone('sine', 300, 600, 0.15, 0, 0.3);
                    playTone('triangle', 150, 300, 0.15, 0, 0.1);
                } else {
                    playTone('sine', 500, 200, 0.15, 0, 0.2);
                }
            }

            function playRatioSelectSound(isActive) {
                if (isActive) {
                    playTone('square', 800, 1200, 0.06, 0, 0.08);
                } else {
                    playTone('triangle', 600, 300, 0.1, 0, 0.1);
                }
            }

            function playFeatureToggleSound(isActive) {
                if (isActive) {
                    playTone('sine', 800, 1200, 0.1, 0, 0.15);
                } else {
                    playTone('sine', 1000, 600, 0.1, 0, 0.15);
                }
            }

            function playSuccessSound() {
                playTone('sine', 523.25, null, 0.3, 0);
                playTone('sine', 659.25, null, 0.4, 0.4);
                playTone('sine', 783.99, null, 0.6, 0.5);
            }

            function playInformationSound() {
                playTone('sine', 550, null, 0.1, 0, 0.6);
                playTone('sine', 880, null, 0.3, 0.1, 0.6);
            }

            function playGalleryUpdatedSound() {
                playTone('sine', 400, 600, 0.1, 0, 0.6);
                playTone('sine', 600, 1200, 0.15, 0.05, 0.55);
            }

            function playDeleteAllWarningSound() {
                playTone('sawtooth', 300, 100, 0.4, 0, 0.2);
                playTone('square', 150, 50, 0.4, 0.05, 0.15);
            }

            function playBusySound() {
                playTone('triangle', 440, 400, 0.1, 0, 0.4);
                playTone('triangle', 440, 400, 0.1, 0.15, 0.4);
            }
            let selectedModel = null;
            let selectedAspectRatio = null;
            let btnFast, btnCreative, btnDense, btnMovie, btnHighRes, btnEnhance;
            let allExtraBtns = [];
            let selectedSize = null;
	        let isGalleryLoading = false;
            let models = [];
            let apiKeyVisible = false;
            let lastEnhancedPrompt = "";
            let isPromptEnhancedByWand = false;
            const viewShareBtn = document.getElementById('btn-share-view');
            const viewShareWrapper = document.getElementById('share-view-wrapper');
            let currentPage = 1;
            const itemsPerPage = 24;
            let currentFilteredItems = []; 
            const DB_NAME = 'ThenaGalleryDB';
            const DB_VERSION = 1;
            const STORE_NAME = 'images';
            let isGeneratingImage = false;
            let currentGenParams = null;

            function createDots(count, type) {
                const icons = {
                    intelligence: {
                        viewBox: "0 0 64 64",
                        content: `
                        <g transform="translate(0,64) scale(0.1,-0.1)">
                            <path d="M310 570 c0 -22 5 -40 10 -40 6 0 10 18 10 40 0 22 -4 40 -10 40 -5 0 -10 -18 -10 -40z"/>
                            <path d="M97 543 c-8 -12 60 -79 70 -69 4 3 -9 23 -29 42 -19 20 -38 32 -41 27z"/>
                            <path d="M500 515 c-19 -19 -30 -38 -26 -42 3 -4 23 9 42 29 20 19 32 38 27 41 -6 4 -25 -9 -43 -28z"/>
                            <path d="M278 500 c-75 -23 -127 -102 -115 -175 8 -48 86 -165 110 -165 16 0 18 5 13 33 -3 17 -8 51 -12 75 -4 26 -12 42 -20 42 -8 0 -14 5 -14 10 0 6 33 10 80 10 47 0 80 -4 80 -10 0 -5 -6 -10 -14 -10 -8 0 -16 -16 -20 -42 -4 -24 -9 -58 -12 -76 -5 -27 -3 -32 13 -32 30 0 105 122 110 179 9 104 -100 192 -199 161z"/>
                            <path d="M50 320 c0 -5 18 -10 40 -10 22 0 40 5 40 10 0 6 -18 10 -40 10 -22 0 -40 -4 -40 -10z"/>
                            <path d="M510 320 c0 -5 18 -10 40 -10 22 0 40 5 40 10 0 6 -18 10 -40 10 -22 0 -40 -4 -40 -10z"/>
                            <path d="M304 248 c11 -95 20 -95 31 0 7 60 6 62 -15 62 -22 0 -22 -2 -16 -62z"/>
                            <path d="M250 120 c0 -6 30 -10 70 -10 40 0 70 4 70 10 0 6 -30 10 -70 10 -40 0 -70 -4 -70 -10z"/>
                            <path d="M262 68 c7 -21 55 -33 85 -22 52 18 39 34 -27 34 -45 0 -61 -3 -58 -12z"/>
                        </g>`
                    },
                    
                    quality: {
                        viewBox: "0 0 64 64",
                        content: `
                        <g transform="translate(0,64) scale(0.1,-0.1)">
                            <path d="M120 585 c0 -3 14 -28 31 -56 l32 -51 53 53 c30 29 54 55 54 56 0 2 -38 3 -85 3 -47 0 -85 -2 -85 -5z"/>
                            <path d="M400 535 c30 -30 55 -55 56 -55 4 0 64 100 64 105 0 3 -39 5 -87 5 l-87 0 54 -55z"/>
                            <path d="M51 532 c-22 -27 -41 -53 -41 -56 0 -3 32 -6 70 -6 39 0 70 3 70 8 0 4 -13 29 -29 55 l-28 48 -42 -49z"/>
                            <path d="M260 525 l-54 -55 114 0 114 0 -54 55 c-30 30 -57 55 -60 55 -3 0 -30 -25 -60 -55z"/>
                            <path d="M518 532 c-16 -28 -28 -53 -28 -56 0 -3 32 -6 70 -6 39 0 70 3 70 8 0 4 -19 29 -43 55 l-42 48 -27 -49z"/>
                            <path d="M136 270 c76 -99 139 -179 141 -177 3 3 -28 105 -93 310 l-16 47 -84 0 -85 0 137 -180z"/>
                            <path d="M200 438 c1 -25 117 -380 123 -372 8 14 117 361 117 373 0 7 -38 11 -120 11 -89 0 -120 -3 -120 -12z"/>
                            <path d="M456 403 c-65 -205 -96 -307 -93 -310 2 -2 65 78 141 177 l137 180 -85 0 -84 0 -16 -47z"/>
                        </g>`
                    },
                    
                    speed: {
                        viewBox: "0 0 64 64",
                        content: '<g transform="translate(0,64) scale(0.1,-0.1)"><path d="M258 454 c-93 -91 -168 -169 -168 -172 1 -21 22 -32 79 -41 35 -6 65 -12 67 -14 2 -1 -21 -42 -52 -89 -55 -87 -61 -118 -23 -118 21 0 378 275 386 297 10 26 -18 41 -87 48 -39 4 -70 8 -70 10 0 1 20 50 45 109 24 58 42 113 39 121 -15 38 -52 12 -216 -151z"/></g>'
                    },
                    
                    default: {
                        viewBox: "0 0 24 24",
                        content: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/>'
                    }
                };

                const iconData = icons[type] || icons.default;

                let html = '';
                for (let i = 0; i < 5; i++) {
                    const isFilled = i < count ? 'filled' : '';
                    html += `
                        <svg class="rating-icon ${isFilled}" viewBox="${iconData.viewBox}">
                            ${iconData.content}
                        </svg>`;
                }
                return html;
            }

            function getPlaceholderHTML(width, height) {
                let spanClass = '';
                const ratio = width / height;
                if (ratio >= 1.7) spanClass = 'wide';
                else if (ratio <= 0.6) spanClass = 'tall';

                return `
                    <div class="gallery-item ${spanClass} placeholder show" id="active-generation-placeholder">
                        <div class="placeholder-loader"></div>
                        <div class="placeholder-text">Generating Image...</div>
                        
                        <svg class="magic-star" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                        <svg class="magic-star" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                        <svg class="magic-star" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                        <svg class="magic-star" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                        <svg class="magic-star" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                    </div>
                `;
            }
            const dbHelper = {
                open: () => {
                    return new Promise((resolve, reject) => {
                        const request = indexedDB.open(DB_NAME, DB_VERSION);
                        request.onupgradeneeded = (event) => {
                            const db = event.target.result;
                            if (!db.objectStoreNames.contains(STORE_NAME)) {
                                db.createObjectStore(STORE_NAME, {
                                    keyPath: 'timestamp'
                                });
                            }
                        };
                        request.onsuccess = (event) => resolve(event.target.result);
                        request.onerror = (event) => reject('Database error: ' + event.target.errorCode);
                    });
                },
                add: async (data) => {
                    const db = await dbHelper.open();
                    return new Promise((resolve, reject) => {
                        const transaction = db.transaction([STORE_NAME], 'readwrite');
                        const store = transaction.objectStore(STORE_NAME);
                        const request = store.add(data);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                getAll: async () => {
                    const db = await dbHelper.open();
                    return new Promise((resolve, reject) => {
                        const transaction = db.transaction([STORE_NAME], 'readonly');
                        const store = transaction.objectStore(STORE_NAME);
                        const request = store.getAll();
                        request.onsuccess = () => {
                            resolve(request.result);
                        };
                        request.onerror = () => reject(request.error);
                    });
                },
                delete: async (timestamp) => {
                    const db = await dbHelper.open();
                    return new Promise((resolve, reject) => {
                        const transaction = db.transaction([STORE_NAME], 'readwrite');
                        const store = transaction.objectStore(STORE_NAME);
                        const request = store.delete(timestamp);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                clear: async () => {
                    const db = await dbHelper.open();
                    return new Promise((resolve, reject) => {
                        const transaction = db.transaction([STORE_NAME], 'readwrite');
                        const store = transaction.objectStore(STORE_NAME);
                        const request = store.clear();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            };
            const LS_KEYS = {
                API_KEY: 'thena-api-key',
                PROMPT: 'thena-last-prompt',
                MODEL: 'thena-last-model',
                RATIO: 'thena-last-ratio',
                SIZE: 'thena-last-size'
            };
            const apiKeyInput = document.getElementById('api-key');
            const promptInput = document.getElementById('prompt');
            const generateBtn = document.getElementById('generate-btn');
            const magicWandBtn = document.getElementById('magic-wand-btn');

            function autoResize(element) {
                element.style.height = 'auto';
                element.style.height = element.scrollHeight + 'px';
            }
            const savedApiKey = localStorage.getItem(LS_KEYS.API_KEY);
            if (savedApiKey) apiKeyInput.value = savedApiKey;
            const savedPrompt = localStorage.getItem(LS_KEYS.PROMPT);
            if (savedPrompt) promptInput.value = savedPrompt;
            apiKeyInput.addEventListener('input', () => {
                const apiKey = apiKeyInput.value.trim();
                if (apiKey) localStorage.setItem(LS_KEYS.API_KEY, apiKey);
                else localStorage.removeItem(LS_KEYS.API_KEY);
                checkFormReady();
            });
            promptInput.addEventListener('input', () => {
                autoResize(promptInput);
                localStorage.setItem(LS_KEYS.PROMPT, promptInput.value);
                if (magicWandBtn.classList.contains('disabled')) {
                    const currentVal = promptInput.value.trim();
                    if (currentVal !== lastEnhancedPrompt) {
                        magicWandBtn.classList.remove('disabled');
                    }
                }
                checkFormReady();
            });

            ['click', 'focus'].forEach(evt => {
                promptInput.addEventListener(evt, () => {
                    autoResize(promptInput);
                });
            });

            function typeWriterEffect(text, element) {
                let i = 0;
                element.value = "";
                element.style.height = 'auto';
                const interval = setInterval(() => {
                    if (i < text.length) {
                        element.value += text.charAt(i);
                        autoResize(element);
                        i++;
                    } else {
                        clearInterval(interval);
                        localStorage.setItem(LS_KEYS.PROMPT, element.value);
                        checkFormReady();
                    }
                }, 10);
            }
            magicWandBtn.addEventListener('click', async () => {
                const currentPrompt = promptInput.value.trim();
                const apiKey = apiKeyInput.value.trim();
                
                if (!currentPrompt) {
                    playErrorSound()
                    showNotification("The prompt field is empty! Please type something.");
                    return;
                }
                if (!apiKey) {
                    playErrorSound()
                    showNotification("Please enter the API key first.");
                    return;
                }
                
                playInformationSound()
                
                const removeLoading = showNotification("Prompt is being improved...", "loading");
                
                magicWandBtn.classList.add('loading');
                generateBtn.disabled = true;
                
                try {
                    const response = await fetch(`https://create.thena.workers.dev/promptGen?prompt=${encodeURIComponent(currentPrompt)}`, {
                        method: 'GET',
                        headers: {
                            "apikey": apiKey
                        }
                    });
                    const data = await response.json();
                    
                    if (removeLoading) removeLoading(); 

                    if (data.status === 200) {
                        lastEnhancedPrompt = data.content;
                        isPromptEnhancedByWand = true;
                        magicWandBtn.classList.add('disabled');
                        typeWriterEffect(data.content, promptInput);
                        playSuccessSound()
                        showNotification("Prompt has been successfully improved!", "success");
                    } else {
                        playErrorSound()
                        showNotification("The prompt could not be created. An error occurred.", "error");
                    }
                } catch (error) {
                    if (removeLoading) removeLoading();
                    
                    playErrorSound()
                    showNotification("An error occurred:" + error.message, "error");
                } finally {
                    magicWandBtn.classList.remove('loading');
                    checkFormReady(); 
                }
            });
            const toggleApiKeyBtn = document.getElementById('toggle-api-key');
            const eyeSlash = document.getElementById('eye-slash');
            const eyePath = document.getElementById('eye-path');
            const eyeCircle = document.getElementById('eye-circle');


            const moderationBtn = document.getElementById('moderation-btn');
            let moderationLevel = 'high';

            if (moderationBtn) {
                moderationBtn.addEventListener('click', () => {
                    if (moderationLevel === 'high') {
                        moderationLevel = 'medium';
                        showNotification('Moderation set to medium.', 'info');
                    } else if (moderationLevel === 'medium') {
                        moderationLevel = 'low';
                        showNotification('Moderation set to low.', 'info');
                    } else {
                        moderationLevel = 'high';
                        showNotification('Moderation set to high.', 'info');
                    }

                    moderationBtn.setAttribute('data-level', moderationLevel);
                    
                    const titles = {
                        high: "Moderation: High (Strict)",
                        medium: "Moderation: Medium (Balanced)",
                        low: "Moderation: Low (Permissive)"
                    };
                    moderationBtn.title = titles[moderationLevel];

                    playInformationSound();
                    
                    moderationBtn.style.transform = 'scale(0.9)';
                    setTimeout(() => moderationBtn.style.transform = '', 150);
                });
            }

            
            toggleApiKeyBtn.addEventListener('click', () => {
                const currentType = apiKeyInput.type;
                const originalValue = apiKeyInput.value;
                
                if (!originalValue) {
                    playInformationSound();
                    showNotification("Enter an API Key first", "info");
                    return;
                }

                if(typeof playFeatureToggleSound === "function") playFeatureToggleSound(true);

                if (currentType === 'password') {
                    
                    apiKeyInput.type = 'text';
                    apiKeyInput.classList.add('hacker-active');
                    
                    eyeSlash.style.opacity = '1';
                    eyePath.style.opacity = '0.3';
                    eyeCircle.style.opacity = '0.3';
                    
                    apiKeyVisible = true;

                    const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*";
                    let iterations = 0;
                    
                    if (window.hackerInterval) clearInterval(window.hackerInterval);

                    window.hackerInterval = setInterval(() => {
                        apiKeyInput.value = originalValue
                            .split("")
                            .map((letter, index) => {
                                if (index < iterations) {
                                    return originalValue[index];
                                }
                                return characters[Math.floor(Math.random() * characters.length)];
                            })
                            .join("");

                        if (iterations >= originalValue.length) {
                            clearInterval(window.hackerInterval);
                            apiKeyInput.value = originalValue;
                            
                            setTimeout(() => {
                                apiKeyInput.classList.remove('hacker-active');
                            }, 200); 
                        }

                        iterations += 1 / 2;
                    }, 10); 

                } else {
                    
                    apiKeyInput.classList.add('hacker-active');
                    
                    setTimeout(() => {
                        apiKeyInput.type = 'password';
                        apiKeyInput.value = originalValue; 
                        apiKeyInput.style.letterSpacing = '';
                        apiKeyInput.classList.remove('hacker-active');
                        
                        eyeSlash.style.opacity = '0';
                        eyePath.style.opacity = '1';
                        eyeCircle.style.opacity = '1';
                        
                        apiKeyVisible = false;
                    }, 150);
                }
            });
            const MOVIE_FILTER_SUPPORTED_MODELS = ["8gg12 61812 6628 19729 6b4a5 5060", "551ks 8g6g8 16gga 1h8h8 6b4a5 5060"];
            function checkMovieFilterAvailability(modelId) {
                if (!btnMovie) return;
                const isSupported = MOVIE_FILTER_SUPPORTED_MODELS.includes(modelId);
                if (isSupported) {
                    btnMovie.disabled = false;
                } else {
                    btnMovie.disabled = true;
                    btnMovie.classList.remove('active');
                }
            }
            function checkFastModeAvailability(modelId) {
                if (!btnFast) return;
                const THENA_MAX_ID = "551ks 8g6g8 16gga 1h8h8 6b4a5 5060";
                if (modelId === THENA_MAX_ID) {
                    btnFast.disabled = true;
                    btnFast.classList.remove('active');
                } else {
                    btnFast.disabled = false;
                }
            }
            document.addEventListener('DOMContentLoaded', () => {
                btnFast = document.getElementById('feat-fast');
                btnCreative = document.getElementById('feat-creative');
                btnDense = document.getElementById('feat-dense');
                btnMovie = document.getElementById('feat-movie');
                btnHighRes = document.getElementById('feat-highres');
                btnEnhance = document.getElementById('feat-enhance');

                if (!btnFast || !btnCreative || !btnDense || !btnMovie || !btnHighRes || !btnEnhance) {
                    return;
                }
                allExtraBtns = [btnFast, btnCreative, btnDense, btnMovie, btnHighRes, btnEnhance];
                const featureData = {
                    'feat-fast': {
                        title: 'Fast Mode',
                        icon: '',
                        desc: 'Optimize generation speed. Reduces generation time significantly but may slightly reduce detail accuracy.',
                        intelligence: 2,
                        quality: 3,
                        speed: 5
                    },
                    'feat-creative': {
                        title: 'Creative Mode',
                        icon: '',
                        desc: 'Increases AI imagination. Results will be more artistic and varied, adhering less strictly to prompt constraints.',
                        intelligence: 4,
                        quality: 4,
                        speed: 2
                    },
                    'feat-dense': {
                        title: 'Dense Mode',
                        icon: '',
                        desc: 'Creative Mode on steroids. Unleashes maximum AI imagination (2x Creative), resulting in highly complex, hyper-detailed, and artistic masterpieces.',
                        intelligence: 5, 
                        quality: 2, 
                        speed: 2 
                    },
                    'feat-movie': {
                        title: 'Movie Filter',
                        icon: '',
                        desc: 'Applies cinematic color grading and lighting effects suitable for movie-like shots. Available only on specific models.',
                        intelligence: 3,
                        quality: 5,
                        speed: 3
                    },
                    'feat-highres': {
                        title: 'HighRes',
                        icon: '',
                        desc: 'Upscales and refines the output for maximum clarity. Best for large format prints or wallpapers.',
                        intelligence: 3,
                        quality: 5,
                        speed: 1
                    },
                    'feat-enhance': {
                        title: 'Prompt Magic',
                        icon: '',
                        desc: 'Automatically enhances your prompt with more details and stylistic improvements before generation.',
                        intelligence: 5,
                        quality: 4,
                        speed: 3
                    }
                };
                const featModal = document.getElementById('feature-info-modal');
                const featModalTitle = document.getElementById('feat-modal-title');
                const featModalDesc = document.getElementById('feat-modal-desc');
                const metricIntel = document.getElementById('metric-intelligence');
                const metricQual = document.getElementById('metric-quality');
                const metricSpeed = document.getElementById('metric-speed');
                const closeFeatModal = document.getElementById('close-feat-modal');
                
                allExtraBtns.forEach(btn => {
                    const infoIcon = btn.querySelector('.info-icon-wrapper');
                    if (infoIcon) {
                        infoIcon.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const data = featureData[btn.id];
                            if (!data) return;
                            
                            featModalTitle.innerHTML = `${data.icon} ${data.title}`;
                            featModalDesc.textContent = data.desc;

                            metricIntel.innerHTML = createDots(data.intelligence, 'intelligence');
                            metricQual.innerHTML = createDots(data.quality, 'quality');
                            metricSpeed.innerHTML = createDots(data.speed, 'speed');
                            
                            featModal.classList.add('active');
                        });
                    }
                    btn.addEventListener('click', (e) => {
                        if (btn.disabled) return;
                        const isActive = btn.classList.toggle('active');
                        playFeatureToggleSound(isActive)
                        if (isActive) createConfetti(btn);
                        if (btn === btnCreative && btn.classList.contains('active')) {
                            btnDense.classList.remove('active');
                        }
                        if (btn === btnDense && btn.classList.contains('active')) {
                            btnCreative.classList.remove('active');
                        }
                    });
                });
                const aspectRatioData = {
                    '1:1': {
                        title: 'Square (1:1)',
                        desc: 'Perfect for social media posts, avatars, and profile pictures. Balanced composition. Slowest.',
                        intelligence: 5,
                        quality: 5,
                        speed: 2
                    },
                    '3:4': {
                        title: 'Portrait (3:4)',
                        desc: 'Classic portrait ratio. Ideal for character designs, mobile wallpapers, and poster art.',
                        intelligence: 4,
                        quality: 4,
                        speed: 3
                    },
                    '4:3': {
                        title: 'Landscape (4:3)',
                        desc: 'Traditional photography format. Great for classic compositions, painting styles, and detailed scenes.',
                        intelligence: 3,
                        quality: 3,
                        speed: 4
                    },
                    '9:16': {
                        title: 'Mobile Vertical (9:16)',
                        desc: 'Full-screen vertical format. Best for TikTok, Reels, Stories, and mobile-first content.',
                        intelligence: 4,
                        quality: 3,
                        speed: 5
                    },
                    '16:9': {
                        title: 'Cinematic (16:9)',
                        desc: 'Widescreen format. The standard for movies, YouTube videos, and desktop wallpapers.',
                        intelligence: 4,
                        quality: 4,
                        speed: 5
                    }
                };
                const aspectBtns = document.querySelectorAll('.aspect-btn');
                aspectBtns.forEach(btn => {
                    const infoIcon = btn.querySelector('.info-icon-wrapper');
                    const ratio = btn.dataset.ratio;
                    if (infoIcon && aspectRatioData[ratio]) {
                        infoIcon.addEventListener('click', (e) => {
                            e.stopPropagation(); 
                            const data = aspectRatioData[ratio];
                            featModalTitle.innerHTML = ` ${data.title}`;
                            featModalDesc.textContent = data.desc;
                            metricIntel.innerHTML = createDots(data.intelligence, 'intelligence');
                            metricQual.innerHTML = createDots(data.quality, 'quality');
                            metricSpeed.innerHTML = createDots(data.speed, 'speed');
                            featModal.classList.add('active');
                        });
                    }
                });
                if (closeFeatModal) {
                    closeFeatModal.addEventListener('click', () => featModal.classList.remove('active'));
                }
                if (featModal) {
                    featModal.addEventListener('click', (e) => {
                        if (e.target === featModal) featModal.classList.remove('active');
                    });
                }
            });
            window.addEventListener('load', () => {
                const progressBar = document.getElementById('progress-bar');
                const loadingScreen = document.getElementById('loading-screen');
                const app = document.getElementById('app');
                let progress = 0;
                let modelsLoaded = false;
                setTimeout(() => {
                    autoResize(promptInput);
                }, 100);
                async function fetchModelsWithRetry() {
                    while (true) {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 1000);

                        try {
                            const response = await fetch('https://create.thena.workers.dev/models', {
                                mode: 'cors',
                                signal: controller.signal
                            });
                            
                            clearTimeout(timeoutId);

                            if (!response.ok) {
                                continue;
                            }
                            
                            return await response.json();
                        } catch (error) {
                            continue;
                        }
                    }
                }

                fetchModelsWithRetry().then(data => {
                    models = data;
                    const imagePromises = models.map(model => {
                        var imgUrl = model.examples?.portraits?.[0];
                        
                        if (model.id == "754019 b5df2e e606f1 a7600b 96b0c8 94") imgUrl = "https://api.apidog.com/api/v1/projects/743905/resources/369883/image-preview"
                        if (model.id == "8gg12 61812 6628 19729 6b4a5 5060") imgUrl = "https://api.apidog.com/api/v1/projects/743905/resources/369760/image-preview"
                        if (model.id == "77h621 yy5271 gga166 hhau22 882hha 1a 3090") imgUrl = "https://api.apidog.com/api/v1/projects/743905/resources/369761/image-preview"
                        if (model.id == "5g72h1 y661hp k771ns 33bb21 77bagl 6b 3090") imgUrl = "https://api.apidog.com/api/v1/projects/743905/resources/369762/image-preview"
                        if (model.id == "551ks 8g6g8 16gga 1h8h8 6b4a5 5060") imgUrl = "https://api.apidog.com/api/v1/projects/743905/resources/369763/image-preview"
                        if (model.id == "6781x 66189 00m162 16g61 00y71 6000") imgUrl = "https://api.apidog.com/api/v1/projects/743905/resources/370236/image-preview"
                        
                        if (!imgUrl) return Promise.resolve();
                        return new Promise((resolve) => {
                            const img = new Image();
                            img.onload = resolve;
                            img.onerror = resolve;
                            img.src = imgUrl;
                        });
                    });
                    return Promise.all(imagePromises);
                }).finally(() => {
                    modelsLoaded = true;
                });
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (!modelsLoaded && progress > 90) progress = 90;
                    if (progress > 100) progress = 100;
                    progressBar.style.width = progress + '%';
                    if (progress === 100 && modelsLoaded) {
                        clearInterval(interval);
                        setTimeout(() => {
                            loadingScreen.classList.add('fade-out');
                            app.classList.add('visible');
                            loadModels();
                            restoreAspectRatio();
                        }, 500);
                    }
                }, 200);
            });
            async function loadModels() {
                if (!models || models.length === 0) {
                    try {
                        const r = await fetch('https://create.thena.workers.dev/models');
                        models = await r.json();
                    } catch (e) {}
                }
                const MODEL_STATS = {
                    // Thena Movie
                    "8gg12 61812 6628 19729 6b4a5 5060": {
                        intel: 5,
                        qual: 5,
                        speed: 3
                    },
                    // Thena Max
                    "551ks 8g6g8 16gga 1h8h8 6b4a5 5060": {
                        intel: 4,
                        qual: 5,
                        speed: 2
                    },
                    // Thena V6
                    "77h621 yy5271 gga166 hhau22 882hha 1a 3090": {
                        intel: 4,
                        qual: 4,
                        speed: 3
                    },
                    // Thena Photoreal
                    "754019 b5df2e e606f1 a7600b 96b0c8 94": {
                        intel: 2,
                        qual: 2,
                        speed: 1
                    },
                    // Thena Anime Core
                    "5g72h1 y661hp k771ns 33bb21 77bagl 6b 3090": {
                        intel: 4,
                        qual: 4,
                        speed: 2
                    },
                    // Thena Anime Fast
                    "6781x 66189 00m162 16g61 00y71 6000": {
                        intel: 2,
                        qual: 3,
                        speed: 5
                    },
                    // Default 
                    "default": {
                        intel: 3,
                        qual: 3,
                        speed: 3
                    }
                };
                const modelSelector = document.getElementById('model-selector');
                modelSelector.innerHTML = models.map(model => {
                    var previewImage = model.examples?.portraits?.[0] || '';
                    if (model.id == "754019 b5df2e e606f1 a7600b 96b0c8 94") previewImage = "https://api.apidog.com/api/v1/projects/743905/resources/369883/image-preview"
                    if (model.id == "8gg12 61812 6628 19729 6b4a5 5060") previewImage = "https://api.apidog.com/api/v1/projects/743905/resources/369760/image-preview"
                    if (model.id == "77h621 yy5271 gga166 hhau22 882hha 1a 3090") previewImage = "https://api.apidog.com/api/v1/projects/743905/resources/369761/image-preview"
                    if (model.id == "5g72h1 y661hp k771ns 33bb21 77bagl 6b 3090") previewImage = "https://api.apidog.com/api/v1/projects/743905/resources/369762/image-preview"
                    if (model.id == "551ks 8g6g8 16gga 1h8h8 6b4a5 5060") previewImage = "https://api.apidog.com/api/v1/projects/743905/resources/369763/image-preview"
                    if (model.id == "6781x 66189 00m162 16g61 00y71 6000") previewImage = "https://api.apidog.com/api/v1/projects/743905/resources/370236/image-preview"
                    return `
                    
									<div class="model-card" data-model-id="${model.id}" data-preview="${previewImage}">
										<div class="model-info-icon-wrapper" title="Model Details">
											<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
												<circle cx="12" cy="12" r="10"></circle>
												<line x1="12" y1="16" x2="12" y2="12"></line>
												<line x1="12" y1="8" x2="12.01" y2="8"></line>
											</svg>
										</div>
										<div class="model-name">${model.model}</div>
									</div>
                `;
                }).join('');
                document.querySelectorAll('.model-card').forEach(card => {
                    const previewImage = card.dataset.preview;
                    const modelId = card.dataset.modelId;
                    const modelName = card.querySelector('.model-name').innerText;
                    if (previewImage) {
                        card.style.setProperty('--bg-image', `url(${previewImage})`);
                        card.style.filter = 'saturate(0.3)';
                    }
                    const infoBtn = card.querySelector('.model-info-icon-wrapper');
                    infoBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const featModal = document.getElementById('feature-info-modal');
                        const featModalTitle = document.getElementById('feat-modal-title');
                        const featModalDesc = document.getElementById('feat-modal-desc');
                        const metricIntel = document.getElementById('metric-intelligence');
                        const metricQual = document.getElementById('metric-quality');
                        const metricSpeed = document.getElementById('metric-speed');
                        const currentModelData = models.find(m => m.id === modelId);
                        const modelDesc = currentModelData ? currentModelData.description : "No description available.";
                        featModalTitle.innerHTML = ` ${modelName}`;
                        featModalDesc.textContent = modelDesc;
                        const cleanId = modelId.replace(/\s/g, '');
                        let stats = MODEL_STATS[modelId] || MODEL_STATS[cleanId] || MODEL_STATS["default"];
                        
                        metricIntel.innerHTML = createDots(stats.intel, 'intelligence');
                        metricQual.innerHTML = createDots(stats.qual, 'quality');
                        metricSpeed.innerHTML = createDots(stats.speed, 'speed');
                        featModal.classList.add('active');
                    });
                    card.addEventListener('click', () => {
                        if (selectedModel === modelId) {
                            playModelSelectSound(false);
                            selectedModel = null;
                            localStorage.removeItem(LS_KEYS.MODEL);
                            card.classList.remove('active');
                            checkMovieFilterAvailability(null);
                            checkFastModeAvailability(null);
                        } else {
                            playModelSelectSound(true);
                            localStorage.setItem(LS_KEYS.MODEL, modelId);
                            document.querySelectorAll('.model-card').forEach(c => c.classList.remove('active'));
                            card.classList.add('active');
                            selectedModel = modelId;
                            createConfetti(card);
                            checkMovieFilterAvailability(modelId);
                            checkFastModeAvailability(modelId);
                        }
                        checkFormReady();
                    });
                });
                const lastModelId = localStorage.getItem(LS_KEYS.MODEL);
                if (lastModelId) {
                    const targetCard = document.querySelector(`.model-card[data-model-id="${lastModelId}"]`);
                    if (targetCard) {
                        targetCard.classList.add('active');
                        selectedModel = lastModelId;
                        checkMovieFilterAvailability(lastModelId);
                        checkFastModeAvailability(lastModelId);
                        checkFormReady();
                    }
                } else {
                    checkMovieFilterAvailability(null);
                    checkFastModeAvailability(null);
                }
            }

            function restoreAspectRatio() {
                const lastRatio = localStorage.getItem(LS_KEYS.RATIO);
                if (lastRatio) {
                    const targetBtn = document.querySelector(`.aspect-btn[data-ratio="${lastRatio}"]`);
                    if (targetBtn) targetBtn.click();
                }
            }

            function createConfetti(element) {
                if (document.body.classList.contains('performance-mode')) return;
                const rect = element.getBoundingClientRect();
                
                const style = getComputedStyle(document.documentElement);
                const colors = [
                    style.getPropertyValue('--primary').trim(),
                    style.getPropertyValue('--dot-filled-2').trim(),
                    style.getPropertyValue('--dot-filled-3').trim(),
                    style.getPropertyValue('--dot-filled-5').trim(),
                    '#ffffff'
                ];

                const particleCount = 20;
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'confetti';
                    
                    const side = Math.floor(Math.random() * 4); 
                    let startX, startY;

                    switch(side) {
                        case 0: 
                            startX = rect.left + Math.random() * rect.width;
                            startY = rect.top;
                            break;
                        case 1: 
                            startX = rect.right;
                            startY = rect.top + Math.random() * rect.height;
                            break;
                        case 2: 
                            startX = rect.left + Math.random() * rect.width;
                            startY = rect.bottom;
                            break;
                        case 3: 
                            startX = rect.left;
                            startY = rect.top + Math.random() * rect.height;
                            break;
                    }

                    particle.style.left = startX + 'px';
                    particle.style.top = startY + 'px';
                    
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    
                    const angle = Math.atan2(startY - centerY, startX - centerX);
                    
                    const velocity = 60 + Math.random() * 50; 
                    
                    const tx = Math.cos(angle) * velocity;
                    const ty = Math.sin(angle) * velocity;
                    
                    particle.style.setProperty('--tx', tx + 'px');
                    particle.style.setProperty('--ty', ty + 'px');
                    
                    document.body.appendChild(particle);
                    
                    particle.style.animation = `confetti-burst ${0.6 + Math.random() * 0.4}s ease-out forwards`;
                    
                    setTimeout(() => particle.remove(), 1000);
                }
            }
            document.querySelectorAll('.aspect-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const ratio = btn.dataset.ratio;
                    if (selectedAspectRatio === ratio) {
                        playRatioSelectSound(false);
                        selectedAspectRatio = null;
                        selectedSize = null;
                        localStorage.removeItem(LS_KEYS.RATIO);
                        localStorage.removeItem(LS_KEYS.SIZE);
                        btn.classList.remove('active');
                    } else {
                        playRatioSelectSound(true);
                        document.querySelectorAll('.aspect-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        selectedAspectRatio = ratio;
                        selectedSize = btn.dataset.size;
                        localStorage.setItem(LS_KEYS.RATIO, selectedAspectRatio);
                        localStorage.setItem(LS_KEYS.SIZE, selectedSize);
                        createConfetti(btn);
                    }
                    checkFormReady();
                });
            });

            var uploadHeaders = {
                "origin2": "https://create.thena.workers.dev"
            };

            function checkFormReady() {
                const promptLength = promptInput.value.trim().length;
                if (promptLength >= 10 && promptLength <= 1150 && apiKeyInput.value.trim() && selectedModel && selectedAspectRatio) {
                    generateBtn.classList.add('ready');
                    generateBtn.disabled = false;
                } else {
                    generateBtn.classList.remove('ready');
                    generateBtn.disabled = true;
                }
            }
            if (savedApiKey) checkFormReady();
            generateBtn.addEventListener('click', async () => {
                if (!generateBtn.classList.contains('ready')) return;
                const currentLength = promptInput.value.trim().length;
                if (currentLength < 10) {
                    playErrorSound();
                    showNotification("Prompt is too short! Please enter at least 10 characters.", "error");
                    return;
                }
                if (currentLength > 1150) {
                    playErrorSound();
                    showNotification("Prompt is too long! Max 1150 characters allowed.", "error");
                    return;
                }
                playStartSound();
                const prompt = promptInput.value.trim();
                const apiKey = apiKeyInput.value.trim();
                const [width, height] = selectedSize.split('x').map(Number);
                
                isGeneratingImage = true;
                currentGenParams = {
                    width,
                    height,
                    prompt
                };
                if (galleryModal.classList.contains('active')) {
                    if (galleryGrid.querySelector('.empty-gallery')) galleryGrid.innerHTML = '';
                    galleryGrid.insertAdjacentHTML('afterbegin', getPlaceholderHTML(width, height));
                }
                const removeLoading = showNotification('Image is being processed...', 'loading');
                generateBtn.disabled = true;
                generateBtn.innerHTML = 'Processing<span class="loading-spinner"></span>';
                generateBtn.classList.add('generating');
                let busyNotification = null;
                const BUSY_THRESHOLD = 25000;
                const busyTimer = setTimeout(() => {
                    playBusySound();
                    busyNotification = document.createElement('div');
                    busyNotification.className = 'notification busy-alert';
                    busyNotification.innerHTML = `
                    
									<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ffaa00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<circle cx="12" cy="12" r="10"></circle>
										<line x1="12" y1="8" x2="12" y2="12"></line>
										<line x1="12" y1="16" x2="12.01" y2="16"></line>
									</svg>
									<div style="display:flex; flex-direction:column;">
										<span style="font-weight:600; color:#ffaa00;">Server Busy</span>
										<span style="font-size:12px; opacity:0.9;">Thena is very busy right now, the process may take a while.</span>
									</div>
                `;
                    document.body.appendChild(busyNotification);
                    setTimeout(() => {
                        if (busyNotification && busyNotification.parentNode) {
                            busyNotification.style.animation = 'slideIn 0.4s ease reverse';
                            setTimeout(() => {
                                if (busyNotification && busyNotification.parentNode) busyNotification.remove();
                            }, 400);
                        }
                    }, 8000);
                }, BUSY_THRESHOLD);
                const isFast = btnFast.classList.contains('active');
                const isCreative = btnCreative.classList.contains('active');
                const isDense = btnDense.classList.contains('active');
                const isMovie = btnMovie.classList.contains('active') && !btnMovie.disabled;
                const isHighRes = btnHighRes.classList.contains('active');
                const isEnhance = btnEnhance.classList.contains('active');

                try {
                    const response = await fetch('https://create.thena.workers.dev/createSync', {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json",
                            "apikey": apiKey
                        },
                        body: JSON.stringify({
                            prompt,
                            model: selectedModel,
                            width,
                            height,
                            fastMode: isFast,
                            creative: isCreative, 
                            denseMode: isDense, 
                            movieFilter: isMovie,
                            highRes: isHighRes,
                            enhance: isEnhance,
			                moderation: moderationLevel
                        })
                    });
                    const data = await response.json();

                    if (removeLoading) removeLoading();

                    if (response.ok && data.image) {
                        playSuccessSound();
                        const modelData = models.find(m => m.id === selectedModel);
                        let finalImageUrl = data.image;
                        if (!finalImageUrl.startsWith('data:image') && !finalImageUrl.startsWith('http')) {
                            finalImageUrl = `data:image/png;base64,${data.image}`;
                        }
                        await dbHelper.add({
                            url: finalImageUrl,
                            prompt: prompt,
                            model: modelData ? modelData.model : 'Unknown',
                            size: selectedSize,
                            timestamp: new Date().toISOString(),
                            moderation: moderationLevel,
                            features: {
                                fast: isFast,
                                creative: isCreative,
                                dense: isDense,
                                movie: isMovie,
                                highRes: isHighRes,
                                enhance: isEnhance
                            }
                        });
                        isGeneratingImage = false; 
                        if (galleryModal.classList.contains('active')) {
                            const placeholder = document.getElementById('active-generation-placeholder');
                            if(placeholder) placeholder.remove();
                    
                            await loadGallery();
                        }
                        showNotification('The image has been saved to the gallery.', 'success', finalImageUrl);
                    } else {
                        playErrorSound();


                        if (data.status == 429) {
                            showNotification('Limit Exceeded! Please wait a few seconds and try again.', 'error');
                            isGeneratingImage = false;
                            const placeholder = document.getElementById('active-generation-placeholder');
                            if (placeholder) {
                                placeholder.style.opacity = '0';
                                setTimeout(() => placeholder.remove(), 300);
                            }
                            return;
                        }
                        if (data.status == 401 && data.content.includes('not allowed')) {
                            showNotification('Please set moderation level to medium or low.', 'error');
                            isGeneratingImage = false;
                            const placeholder = document.getElementById('active-generation-placeholder');
                            if (placeholder) {
                                placeholder.style.opacity = '0';
                                setTimeout(() => placeholder.remove(), 300);
                            }
                            return;
                        }
                        if (data.status == 423) {
                            showNotification('Thena is currently overloaded. Please try again later.', 'error');
                            isGeneratingImage = false;
                            const placeholder = document.getElementById('active-generation-placeholder');
                            if (placeholder) {
                                placeholder.style.opacity = '0';
                                setTimeout(() => placeholder.remove(), 300);
                            }
                            return;
                        }

                        showNotification(`Error: ${data.content || 'Unknown Error'}`, 'error');
                    }
                } catch (error) {
                    if (removeLoading) removeLoading();
                    playErrorSound();
                    showNotification("There was an error generating the image. Please try again.", 'error');
                    isGeneratingImage = false;
                    const placeholder = document.getElementById('active-generation-placeholder');
                    if (placeholder) {
                        placeholder.style.opacity = '0';
                        setTimeout(() => placeholder.remove(), 300);
                    }
                } finally {
		            isGeneratingImage = false;
                    clearTimeout(busyTimer);
                    await loadGallery();
                    if (busyNotification && busyNotification.parentNode) {
                        busyNotification.remove();
                    }
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'Generate Image';
                    generateBtn.classList.remove('generating');
                    checkFormReady();
                }
            });
            const galleryBtn = document.getElementById('gallery-btn');
            const galleryModal = document.getElementById('gallery-modal');
            const closeGalleryBtn = document.getElementById('close-gallery');
            const galleryGrid = document.getElementById('gallery-grid');
            let allGalleryImages = [];
            let sortNewestFirst = true;
            const searchInput = document.getElementById('search-input');
            const toggleFilterBtn = document.getElementById('toggle-filter-btn');
            const filterPanel = document.getElementById('filter-panel');
            const toggleSortBtn = document.getElementById('toggle-sort-btn');
            const sortText = document.getElementById('sort-text');
            const sortIcon = document.getElementById('sort-icon');
            const filterModel = document.getElementById('filter-model');
            const filterRatio = document.getElementById('filter-ratio');
            const filterDateStart = document.getElementById('filter-date-start');
            const filterDateEnd = document.getElementById('filter-date-end');
            const resetFiltersBtn = document.getElementById('reset-filters');
            galleryBtn.addEventListener('click', async () => {
                galleryModal.classList.add('active');
                document.body.classList.add('no-scroll');
                await loadGallery();
            });
            closeGalleryBtn.addEventListener('click', () => {
                galleryModal.classList.remove('active');
                document.body.classList.remove('no-scroll');
            });
            galleryModal.addEventListener('click', (e) => {
                if (e.target === galleryModal) {
                    galleryModal.classList.remove('active');
                    document.body.classList.remove('no-scroll');
                }
            });
            function populateModelFilter() {
                filterModel.innerHTML = '<option value="">All Models</option>';

                if (models && models.length > 0) {
                    models.forEach(m => {
                        const opt = document.createElement('option');
                        opt.value = m.model;
                        opt.textContent = m.model;
                        filterModel.appendChild(opt);
                    });
                }
            }

            const galleryLoader = document.getElementById('gallery-loader');
            const galleryProgressBar = document.getElementById('gallery-progress-bar');
            const loaderStatus = document.getElementById('loader-status');
            async function loadGallery() {
                galleryGrid.classList.remove('visible'); 
                galleryLoader.classList.remove('hidden'); 
                galleryProgressBar.style.width = '0%';
                loaderStatus.innerText = 'Reading the database...';

                galleryGrid.innerHTML = '';
                populateModelFilter();
                try {
                    allGalleryImages = await dbHelper.getAll();
                    applyFilters(true);
                } catch (e) {
                    galleryGrid.innerHTML = '<div class="empty-gallery">An error occurred while loading the gallery.</div>';
                    galleryLoader.classList.add('hidden');
                    galleryGrid.classList.add('visible');
                }
            }
            galleryGrid.addEventListener('scroll', () => {
                if (isGalleryLoading) return; 

                if (galleryGrid.scrollTop + galleryGrid.clientHeight >= galleryGrid.scrollHeight - 100) {
                    currentPage++;
                    loadMoreItems();
                }
            });

            function applyFilters(withAnimation = false) {
                let filtered = [...allGalleryImages];

                const uniqueMap = new Map();
                filtered.forEach(item => {
                    if(!uniqueMap.has(item.timestamp)){
                        uniqueMap.set(item.timestamp, item);
                    }
                });
                filtered = Array.from(uniqueMap.values());

                const searchText = searchInput.value.toLowerCase().trim();
                if (searchText) {
                    filtered = filtered.filter(item => item.prompt.toLowerCase().includes(searchText));
                }
                const modelVal = filterModel.value;
                if (modelVal) filtered = filtered.filter(item => item.model === modelVal);
                const ratioVal = filterRatio.value;
                if (ratioVal) filtered = filtered.filter(item => item.size === ratioVal);
                const startDateStr = filterDateStart.value;
                const endDateStr = filterDateEnd.value;
                if (startDateStr) {
                    const start = new Date(startDateStr).setHours(0, 0, 0, 0);
                    filtered = filtered.filter(item => new Date(item.timestamp).setHours(0, 0, 0, 0) >= start);
                }
                if (endDateStr) {
                    const end = new Date(endDateStr).setHours(23, 59, 59, 999);
                    filtered = filtered.filter(item => new Date(item.timestamp).setHours(0, 0, 0, 0) <= end);
                }
                filtered.sort((a, b) => {
                    const dateA = new Date(a.timestamp);
                    const dateB = new Date(b.timestamp);
                    return sortNewestFirst ? dateB - dateA : dateA - dateB;
                });
                currentFilteredItems = filtered;
                currentPage = 1;
                galleryGrid.innerHTML = '';

                if (isGeneratingImage && currentGenParams && sortNewestFirst) {
                    galleryGrid.insertAdjacentHTML('beforeend', getPlaceholderHTML(currentGenParams.width, currentGenParams.height));
                }


                if (currentFilteredItems.length === 0 && !isGeneratingImage) {
                    galleryGrid.innerHTML = '<div class="empty-gallery">No images matching the filters were found.</div>';
                    hideLoaderAndShowGrid();
                    return;
                }
                if (withAnimation) {
                    preloadImagesAndRender();
                } else {
                    loadMoreItems();
                    hideLoaderAndShowGrid();
                }
            }

            function preloadImagesAndRender() {
                const initialBatchCount = 12;
                const itemsToPreload = currentFilteredItems.slice(0, initialBatchCount);
                let loadedCount = 0;
                const batchSize = itemsToPreload.length;
                const totalGalleryCount = currentFilteredItems.length;
                if (batchSize === 0) {
                    hideLoaderAndShowGrid();
                    return;
                }
                loaderStatus.innerText = `Images are being processed (${totalGalleryCount} images)...`;
                itemsToPreload.forEach((item) => {
                    const img = new Image();
                    const updateProgress = () => {
                        loadedCount++;
                        const percentage = Math.round((loadedCount / batchSize) * 100);
                        galleryProgressBar.style.width = percentage + '%';
                        loaderStatus.innerText = `Images are being processed (${totalGalleryCount} images)... %${percentage}`;
                        if (loadedCount === batchSize) {
                            setTimeout(() => {
                                loadMoreItems();
                                hideLoaderAndShowGrid();
                                setTimeout(() => {
                                    if (galleryGrid.scrollHeight <= galleryGrid.clientHeight + 100) {
                                        currentPage++;
                                        loadMoreItems();
                                    }
                                }, 500);
                            }, 300);
                        }
                    };
                    img.onload = updateProgress;
                    img.onerror = updateProgress;
                    img.src = item.url;
                });
            }

            function hideLoaderAndShowGrid() {
                galleryLoader.classList.add('hidden');
                playGalleryUpdatedSound();
                setTimeout(() => {
                    galleryGrid.classList.add('visible');
                }, 100);
            }

            function loadMoreItems() {
                isGalleryLoading = true;
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                const batch = currentFilteredItems.slice(start, end);
                if (batch.length === 0) {
                    isGalleryLoading = false;
                    return;
                }

                const html = batch.map((item) => {
                    let spanClass = '';
                    if (item.size) {
                        const [width, height] = item.size.split('x').map(Number);
                        const ratio = width / height;
                        if (ratio >= 1.7) spanClass = 'wide';
                        else if (ratio <= 0.6) spanClass = 'tall';
                    }

                    if (item.moderation === 'medium') {
                        spanClass += ' sensitive-medium';
                    } else if (item.moderation && item.moderation !== 'high') {
                        spanClass += ' sensitive';
                    }

                    const itemData = encodeURIComponent(JSON.stringify(item));

                    return `
                        <div class="gallery-item ${spanClass}" data-item="${itemData}">
                            <img src="${item.url}" loading="lazy" alt="${item.prompt}">
                            
                            <button class="gallery-copy-btn" title="Use This Style" onclick="useImageSettings(event, this)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="12" y1="18" x2="12" y2="12"></line>
                                    <line x1="9" y1="15" x2="15" y2="15"></line>
                                </svg>
                            </button>
                            <div class="gallery-item-info">
                                <div class="info-prompt">${item.prompt}</div>
                                <div class="info-meta">${item.model.toUpperCase()}  ${item.size || 'Auto'}</div>
                            </div>
                        </div>`;
                }).join('');

                galleryGrid.insertAdjacentHTML('beforeend', html);
                const newItems = galleryGrid.querySelectorAll('.gallery-item:not(.show)');
                newItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.add('show');
                    }, index * 50);
                });
		        isGalleryLoading = false;
                if (galleryGrid.scrollHeight <= galleryGrid.clientHeight + 200 && end < currentFilteredItems.length) {
                    setTimeout(() => {
                        if (!isGalleryLoading) {
                            currentPage++;
                            loadMoreItems();
                        }
                    }, batch.length * 50); 
                }
            }
            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    applyFilters(false);
                }, 300);
            });
            filterModel.addEventListener('change', applyFilters);
            filterRatio.addEventListener('change', applyFilters);
            filterDateStart.addEventListener('change', applyFilters);
            filterDateEnd.addEventListener('change', applyFilters);
            toggleFilterBtn.addEventListener('click', () => {
                filterPanel.classList.toggle('active');
                toggleFilterBtn.classList.toggle('active');
            });
            toggleSortBtn.addEventListener('click', () => {
                sortNewestFirst = !sortNewestFirst;
                sortText.textContent = sortNewestFirst ? "Newest" : "Oldest";
                sortIcon.style.transform = sortNewestFirst ? "rotate(0deg)" : "rotate(180deg)";
                sortIcon.style.transition = "transform 0.3s ease";
                applyFilters();
            });
            resetFiltersBtn.addEventListener('click', () => {
                searchInput.value = '';
                filterModel.value = '';
                filterRatio.value = '';
                filterDateStart.value = '';
                filterDateEnd.value = '';
                applyFilters();
            });
            function getFileSize(dataUrl) {
                if (!dataUrl.startsWith('data:')) return '';
                const base64Length = dataUrl.length - (dataUrl.indexOf(',') + 1);
                const padding = (dataUrl.charAt(dataUrl.length - 1) === '=') ? (dataUrl.charAt(dataUrl.length - 2) === '=' ? 2 : 1) : 0;
                const fileSizeInBytes = (base64Length * 0.75) - padding;
                if (fileSizeInBytes > 1024 * 1024) {
                    return (fileSizeInBytes / (1024 * 1024)).toFixed(1) + 'MB';
                } else {
                    return (fileSizeInBytes / 1024).toFixed(0) + 'KB';
                }
            }
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxPrompt = document.getElementById('lightbox-prompt');
            const lightboxMeta = document.getElementById('lightbox-meta');
            const lightboxDownload = document.getElementById('lightbox-download');
            galleryGrid.addEventListener('click', (e) => {
                const item = e.target.closest('.gallery-item');
                if (item) {
                    try {
                        const data = JSON.parse(decodeURIComponent(item.dataset.item));
                        openLightbox(data);
                    } catch {}
                }
            });
            let currentImageTimestamp = null;

            function openLightbox(data) {
                currentImageTimestamp = data.timestamp;
                lightboxImg.src = data.url; 
                
                lightboxPrompt.textContent = data.prompt;
                
                const dateObj = new Date(data.timestamp);
                const dateFormatted = dateObj.toLocaleDateString(undefined);
                const timeFormatted = dateObj.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });

                let featuresHtml = '';
                
                if (data.features) {
                    featuresHtml = '<div class="features-container">';
                    
                    const icons = {
                        high: `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>`,
                        medium: `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,
                        low: `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.1.8-2.2 1.5-3.1v-.1z"></path></svg>`
                    };

                    const modLevel = data.moderation || 'high'; 
                    const modTitle = modLevel.charAt(0).toUpperCase() + modLevel.slice(1);
        
                    featuresHtml += `<span class="feat-badge mod-${modLevel}" title="Moderation: ${modTitle}">
                                        ${icons[modLevel] || icons['high']} ${modTitle}
                                    </span>`;

                    if (data.features.fast)     featuresHtml += `<span class="feat-badge" title="Fast Mode"> Fast</span>`;
                    if (data.features.creative) featuresHtml += `<span class="feat-badge" title="Creative Mode"> Creative</span>`;
                    if (data.features.dense)    featuresHtml += `<span class="feat-badge" title="Dense Mode"> Dense</span>`;
                    if (data.features.movie)    featuresHtml += `<span class="feat-badge" title="Movie Filter"> Movie</span>`;
                    if (data.features.highRes)  featuresHtml += `<span class="feat-badge" title="High Resolution"> HighRes</span>`;
                    if (data.features.enhance)  featuresHtml += `<span class="feat-badge" title="Enhance"> Enhanced</span>`;
                    
                    featuresHtml += '</div>';
                }

                lightboxMeta.innerHTML = `
                    <div style="margin-bottom:5px;">${data.model.toUpperCase()}  ${data.size || 'Auto'}</div>
                    <span class="meta-date">${dateFormatted}  ${timeFormatted}</span>
                    ${featuresHtml}
                `;

                const sizeStr = getFileSize(data.url);
                lightboxDownload.href = data.url;
                lightboxDownload.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download ${sizeStr ? `(${sizeStr})` : ''}
                `;
                
    
                const copyBtn = document.getElementById('lightbox-copy-btn');
                if (copyBtn) {
                    const newCopyBtn = copyBtn.cloneNode(true);
                    copyBtn.parentNode.replaceChild(newCopyBtn, copyBtn);
                    
                    newCopyBtn.onclick = function() {
                        const promptInput = document.getElementById('prompt');
                        promptInput.value = data.prompt || "";
                        localStorage.setItem(LS_KEYS.PROMPT, data.prompt);
                        promptInput.style.height = 'auto';
                        promptInput.style.height = promptInput.scrollHeight + 'px';

                        if (models && models.length > 0 && data.model) {
                            const targetModelObj = models.find(m => 
                                m.model.trim().toLowerCase() === data.model.trim().toLowerCase()
                            );
                            
                            if (targetModelObj) {
                                if (selectedModel !== targetModelObj.id) {
                                    const modelCard = document.querySelector(`.model-card[data-model-id="${targetModelObj.id}"]`);
                                    if (modelCard) modelCard.click();
                                }
                            }
                        }

                        if (data.size) {
                            if (selectedSize !== data.size) {
                                const sizeBtn = document.querySelector(`.aspect-btn[data-size="${data.size}"]`);
                                if (sizeBtn) sizeBtn.click();
                            }
                        }

                        const modBtn = document.getElementById('moderation-btn');
                        const targetMod = data.moderation || 'high'; 
                        if (modBtn) {
                            modBtn.setAttribute('data-level', targetMod);
                            moderationLevel = targetMod;
                            const titles = {
                                high: "Moderation: High (Strict)",
                                medium: "Moderation: Medium (Balanced)",
                                low: "Moderation: Low (Permissive)"
                            };
                            modBtn.title = titles[targetMod];
                        }

                        allExtraBtns.forEach(b => b.classList.remove('active'));

                        if (data.features) {
                            if (data.features.fast && btnFast && !btnFast.disabled) btnFast.classList.add('active');
                            if (data.features.creative && btnCreative) btnCreative.classList.add('active');
                            
                            if (data.features.dense && btnDense) {
                                btnDense.classList.add('active');
                                if(btnCreative) btnCreative.classList.remove('active');
                            }
                            
                            if (data.features.movie && btnMovie && !btnMovie.disabled) btnMovie.classList.add('active');
                            if (data.features.highRes && btnHighRes) btnHighRes.classList.add('active');
                            if (data.features.enhance && btnEnhance) btnEnhance.classList.add('active');
                        }

                        checkFormReady();

                        const lightbox = document.getElementById('lightbox');
                        const galleryModal = document.getElementById('gallery-modal');
                        
                        lightbox.classList.remove('active');
                        
                        setTimeout(() => {
                            if(galleryModal) galleryModal.classList.remove('active');
                            document.body.classList.remove('no-scroll');
                        }, 100);

                        playSuccessSound();
                        showNotification("Settings applied successfully!", "success", data.url);
                        
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    };
                }

                lightbox.classList.add('active');

                if (data.isShowcase) {
                    document.querySelector(".lightbox-delete-btn").style.display = "none"
                    document.querySelector(".lightbox-share-btn").style.display = "none"
                    document.querySelector(".lightbox-copy-btn").style.display = "none"
                    const infoMeta = document.querySelector('.lightbox-meta');
                    if (infoMeta) infoMeta.textContent = data.model.replace(/i/gi, 'I')
                    infoMeta.style.marginBottom = "8px"
                } 
                else {
                    document.querySelector(".lightbox-delete-btn").style.display = "flex"
                    document.querySelector(".lightbox-share-btn").style.display = "flex"
                    document.querySelector(".lightbox-copy-btn").style.display = "flex"
                }
            }

            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    lightbox.classList.remove('active');
                    setTimeout(() => lightboxImg.src = '', 300);
                }
            });

            const deleteBtn = document.getElementById('lightbox-delete');
            const confirmModal = document.getElementById('confirm-modal');
            const btnCancel = document.getElementById('btn-cancel');
            const btnConfirm = document.getElementById('btn-confirm');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                confirmModal.classList.add('active');
            });
            btnCancel.addEventListener('click', () => {
                confirmModal.classList.remove('active');
            });
            confirmModal.addEventListener('click', (e) => {
                if (e.target === confirmModal) {
                    confirmModal.classList.remove('active');
                }
            });
            btnConfirm.addEventListener('click', async () => {
                try {
                    if (currentImageTimestamp) {
                        await dbHelper.delete(currentImageTimestamp);
                        confirmModal.classList.remove('active');
                        lightbox.classList.remove('active');
                        await loadGallery(); 
                        playSuccessSound()
                        showNotification("The image has been successfully deleted.");
                    }
                } catch (error) {
                    confirmModal.classList.remove('active');
                    playErrorSound()
                    showNotification("An error occurred during the deletion process.");
                }
            });
            let activeNotification = null;

            function injectNotificationStyles() {
                if (!document.getElementById('notification-dynamic-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-dynamic-styles';
                    style.innerHTML = `
                        @keyframes slideOutRight {
                            0% { transform: translateX(0); opacity: 1; }
                            100% { transform: translateX(120%); opacity: 0; }
                        }
                        .notification-exit {
                            animation: slideOutRight 0.5s cubic-bezier(0.2, 1, 0.3, 1) forwards;
                            transition: max-height 0.5s ease, margin-bottom 0.5s ease, padding 0.5s ease, opacity 0.5s ease;
                            overflow: hidden;
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            if (typeof injectNotificationStyles === 'function') injectNotificationStyles();

            function showNotification(message, type = 'info', imageUrl = null, duration = 4000) {
                let container = document.getElementById('notification-container');
                if (!container) {
                    container = document.createElement('div');
                    container.id = 'notification-container';
                    container.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 50000;
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                        pointer-events: none;
                        max-width: 350px;
                        width: 100%;
                        transition: all 0.3s ease;
                    `;
                    document.body.appendChild(container);
                }

                const isPerfMode = document.body.classList.contains('performance-mode');

                const notification = document.createElement('div');
                notification.className = 'notification';

                notification.style.position = 'relative';
                notification.style.pointerEvents = 'auto';
                notification.style.margin = '0';
                notification.style.width = '100%';
                notification.style.maxHeight = '150px'; 

                if (isPerfMode) {
                    notification.style.opacity = '1';
                    notification.style.transform = 'none';
                    notification.style.animation = 'none';
                } else {
                    notification.style.opacity = '0';
                    notification.style.animation = 'slideIn 0.4s cubic-bezier(0.2, 1, 0.3, 1) forwards';
                }

                let contentHtml = '';
                if (type === 'loading') {
                    contentHtml = `
                        <div class="notification-spinner"></div>
                        <span>${message}</span>`;
                } else if (type === 'success' && imageUrl) {
                    contentHtml = `
                        <img src="${imageUrl}" class="notification-thumb" alt="Preview">
                        <div style="display:flex; flex-direction:column;">
                            <span style="font-weight:600; color:#00ff88;">Success!</span>
                            <span style="font-size:12px; opacity:0.8;">${message}</span>
                            <span style="font-size:10px; color:#888; margin-top:2px;">Click here for the gallery </span>
                        </div>`;
                    notification.classList.add('clickable');
                    
                    notification.onclick = async (e) => {
                        if (notification.classList.contains('notification-exit')) return;
                        const galleryModal = document.getElementById('gallery-modal');
                        if (galleryModal) {
                            galleryModal.classList.add('active');
                            document.body.classList.add('no-scroll');
                            if (typeof loadGallery === 'function') await loadGallery();
                        }
                        removeNotification(notification);
                    };
                } else {
                    contentHtml = `<span>${message}</span>`;
                }

                if (type === 'success') {
                    notification.style.borderColor = '#00ff88';
                    notification.style.backgroundColor = 'rgba(0, 255, 136, 0.1)';
                } else if (type === 'error') {
                    notification.style.borderColor = '#ff4444';
                    notification.style.backgroundColor = 'rgba(255, 68, 68, 0.1)';
                } else if (type === 'info') {
                    notification.style.borderColor = '#4488ff';
                    notification.style.backgroundColor = 'rgba(68, 136, 255, 0.1)';
                }

                if (message === "Moderation set to medium.") {
                    notification.style.borderColor = '#ffaa00';
                    notification.style.backgroundColor = 'rgba(255, 170, 0, 0.1)';
                } else if (message === "Moderation set to low.") {
                    notification.style.borderColor = '#ff55ff';
                    notification.style.backgroundColor = 'rgba(255, 85, 255, 0.1)';
                } else if (message === "Moderation set to high.") {
                    notification.style.borderColor = '#00aaff';
                    notification.style.backgroundColor = 'rgba(0, 170, 255, 0.1)';
                } else if (message === "The image has been successfully deleted.") {
                    notification.style.borderColor = '#ff4444';
                    notification.style.backgroundColor = 'rgba(255, 68, 68, 0.1)';
                }
                
                notification.innerHTML = contentHtml;
                container.appendChild(notification);

                const removeNotification = (targetNote) => {
                    if (targetNote.classList.contains('notification-exit')) return;

                    if (document.body.classList.contains('performance-mode')) {
                        if (targetNote.parentNode) targetNote.remove();
                        if (container.children.length === 0) container.remove();
                        return;
                    }

                    targetNote.style.maxHeight = targetNote.scrollHeight + 'px';
                    void targetNote.offsetWidth;
                    targetNote.classList.add('notification-exit');

                    targetNote.style.maxHeight = '0';
                    targetNote.style.marginBottom = '0';
                    targetNote.style.paddingTop = '0';
                    targetNote.style.paddingBottom = '0';
                    targetNote.style.opacity = '0';
                    targetNote.style.borderWidth = '0';
                    targetNote.style.marginTop = '0';

                    setTimeout(() => {
                        if (targetNote.parentNode) targetNote.remove();
                        if (container.children.length === 0) container.remove();
                    }, 500);
                };

                if (type !== 'loading') {
                    setTimeout(() => {
                        removeNotification(notification);
                    }, duration);
                }
                
                return () => removeNotification(notification);
            }
            const redirectModal = document.getElementById('redirect-modal');
            const redirectTitle = document.getElementById('redirect-title');
            const redirectDesc = document.getElementById('redirect-desc');
            const btnRedirectConfirm = document.getElementById('btn-redirect-confirm');
            const btnRedirectCancel = document.getElementById('btn-redirect-cancel');
            let targetUrl = "";

            function openRedirectModal(type) {
                const t = {
                    redirectBotTitle: "Open Telegram Bot",
                    redirectBotDesc: "You are being redirected to Thena AI Bot on Telegram.",
                    redirectOwnerTitle: "Contact Developer",
                    redirectOwnerDesc: "You are being redirected to the developer's profile.",
                    redirectDonateTitle: "Support Thena AI",
                    redirectDonateDesc: "You are being redirected to our donation page. Thank you for your support!",
                    btnGo: "Go",
                    btnCancel: "Cancel"
                }
                if (type === 'bot') {
                    targetUrl = "https://t.me/ThenaAIBot";
                    redirectTitle.textContent = t.redirectBotTitle;
                    redirectDesc.textContent = t.redirectBotDesc;
                } else if (type === 'owner') {
                    targetUrl = "https://t.me/phaticusthiccy";
                    redirectTitle.textContent = t.redirectOwnerTitle;
                    redirectDesc.textContent = t.redirectOwnerDesc;
                } 
                else if (type === 'donate') {
                    targetUrl = "https://thenaai.carrd.co/";
                    redirectTitle.textContent = t.redirectDonateTitle;
                    redirectDesc.textContent = t.redirectDonateDesc;
                }

                btnRedirectConfirm.textContent = t.btnGo;
                btnRedirectCancel.textContent = t.btnCancel;
                redirectModal.classList.add('active');
            }
            document.getElementById('btn-open-bot').addEventListener('click', () => openRedirectModal('bot'));
            document.getElementById('btn-open-owner').addEventListener('click', () => openRedirectModal('owner'));
            document.getElementById('btn-donate').addEventListener('click', () => openRedirectModal('donate'));
            btnRedirectCancel.addEventListener('click', () => {
                redirectModal.classList.remove('active');
            });
            btnRedirectConfirm.addEventListener('click', () => {
                window.open(targetUrl, '_blank');
                redirectModal.classList.remove('active');
            });
            redirectModal.addEventListener('click', (e) => {
                if (e.target === redirectModal) redirectModal.classList.remove('active');
            });
            
            const deleteAllBtn = document.getElementById('delete-all-btn');
            const deleteAllModal = document.getElementById('delete-all-modal');
            const btnCancelAll = document.getElementById('btn-cancel-all');
            const btnConfirmAll = document.getElementById('btn-confirm-all');


            if (deleteAllBtn) {
                deleteAllBtn.addEventListener('click', () => {
                    if (!allGalleryImages || allGalleryImages.length === 0) {
                        playInformationSound();
                        showNotification("The gallery is already empty.", "info");
                        return;
                    }
                    playDeleteAllWarningSound();
                    deleteAllModal.classList.add('active');
                });
            }
            if (btnCancelAll) {
                btnCancelAll.addEventListener('click', () => {
                    deleteAllModal.classList.remove('active');
                });
            }
            if (deleteAllModal) {
                deleteAllModal.addEventListener('click', (e) => {
                    if (e.target === deleteAllModal) deleteAllModal.classList.remove('active');
                });
            }
            if (btnConfirmAll) {
                btnConfirmAll.addEventListener('click', async () => {
                    try {
                        await dbHelper.clear();
                        allGalleryImages = []; 
                        galleryGrid.innerHTML = '<div class="empty-gallery">No images yet. Start generating!</div>';
                        deleteAllModal.classList.remove('active');
                        playSuccessSound()
                        showNotification("The entire gallery has been successfully cleaned.", "success");
                    } catch (error) {
                        console.error("Error deleting all images:", error);
                        playErrorSound()
                        showNotification("An error occurred during the deletion process.", "error");
                        deleteAllModal.classList.remove('active');
                    }
                });
            }


            const lightboxCloseBtn = document.getElementById('lightbox-close');

            if (lightboxCloseBtn) {
                lightboxCloseBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    const lightbox = document.getElementById('lightbox');
                    const lightboxImg = document.getElementById('lightbox-img');
                    
                    if (lightbox) lightbox.classList.remove('active');
                    
                    setTimeout(() => {
                        if (lightboxImg) lightboxImg.src = '';
                    }, 300);
                });
            }

            function useImageSettings(event, btnElement) {
                event.stopPropagation(); 
                
                const parentItem = btnElement.closest('.gallery-item');
                if (!parentItem) return;
                
                let data;
                try {
                    data = JSON.parse(decodeURIComponent(parentItem.dataset.item));
                } catch (e) {
                    return;
                }

                const promptInput = document.getElementById('prompt');
                promptInput.value = data.prompt;
                localStorage.setItem(LS_KEYS.PROMPT, data.prompt);
                promptInput.style.height = 'auto'; 
                promptInput.style.height = promptInput.scrollHeight + 'px';

                if (models && models.length > 0) {
                    const targetModelObj = models.find(m => m.model === data.model);
                    if (targetModelObj) {
                        const modelCard = document.querySelector(`.model-card[data-model-id="${targetModelObj.id}"]`);
                        if (modelCard) modelCard.click();
                    }
                }

                if (data.size) {
                    const sizeBtn = document.querySelector(`.aspect-btn[data-size="${data.size}"]`);
                    if (sizeBtn) sizeBtn.click();
                }

                const modBtn = document.getElementById('moderation-btn');
                if (modBtn && data.moderation) {
                    modBtn.setAttribute('data-level', data.moderation);
                    moderationLevel = data.moderation;
                }

                allExtraBtns.forEach(b => b.classList.remove('active'));
                if (data.features) {
                    if (data.features.fast && btnFast) btnFast.classList.add('active');
                    if (data.features.creative && btnCreative) btnCreative.classList.add('active');
                    if (data.features.dense && btnDense) btnDense.classList.add('active');
                    if (data.features.movie && btnMovie && !btnMovie.disabled) btnMovie.classList.add('active');
                    if (data.features.highRes && btnHighRes) btnHighRes.classList.add('active');
                }

                const galleryModal = document.getElementById('gallery-modal');
                galleryModal.classList.remove('active');
                document.body.classList.remove('no-scroll');

                checkFormReady();

                playSuccessSound();
                showNotification(
                    "Settings loaded from this image!", 
                    "success", 
                    data.url
                );
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }



        const shareBtn = document.getElementById('lightbox-share-btn');
        const shareModal = document.getElementById('share-modal');
        const closeShareBtn = document.getElementById('btn-share-close');
        const copyShareLinkBtn = document.getElementById('btn-share-copy');
        const shareUrlDisplay = document.getElementById('share-url-display');

        if (shareBtn) {
            shareBtn.addEventListener('click', async (e) => {
                e.stopPropagation();
                
                shareModal.classList.add('active');
                if(viewShareWrapper) viewShareWrapper.classList.remove('open');
                if(viewShareBtn) viewShareBtn.classList.remove('visible');
                shareUrlDisplay.value = "Uploading to server...";
                copyShareLinkBtn.textContent = "Wait...";
                copyShareLinkBtn.disabled = true;
                copyShareLinkBtn.style.background = "#222";
                copyShareLinkBtn.style.cursor = "not-allowed";

                try {
                    const img = document.getElementById('lightbox-img');
                    let base64Data = img.src;
                    
                    if (base64Data.startsWith('data:image')) {
                        const rawBase64 = base64Data.split(',')[1];

                        var infometa = document.querySelector(".lightbox-meta").textContent
                        infometa = infometa.replace(/\n/g, ' ').trim().toLocaleLowerCase()
                        let infoModel = infometa.split("")[0].trim();
                        let infoRatio = infometa.split("")[1].trim().split(" ")[0];
                        let infoModeration = infometa.split("")[2].trim().includes("high") ? "high" : (infometa.split("")[2].trim().includes("medium") ? "medium" : "low");

                        let infoModel2 = infoModel.split(" ");

                        for (let i = 0; i < infoModel2.length; i++) {
                            infoModel2[i] = infoModel2[i][0].toUpperCase() + infoModel2[i].substr(1);
                        }

                        infoModel2 = infoModel2.join(" ");

                        const response = await fetch('https://create.thena.workers.dev/showcaseUpload', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                ...uploadHeaders
                            },
                            body: JSON.stringify({
                                image: rawBase64,
                                apikey: apiKeyInput ? apiKeyInput.value.trim() : "",
                                prompt: document.querySelector(".lightbox-prompt").textContent,
                                model: infoModel2 ? infoModel2 : "",
                                ratio: infoRatio ? infoRatio : "",
                                moderation: infoModeration ? infoModeration : "high",
                                features: [
                                    btnFast.classList.contains('active') ? "fast" : "",
                                    btnCreative.classList.contains('active') ? "creative" : "",
                                    btnDense.classList.contains('active') ? "dense" : "",
                                    btnMovie.classList.contains('active') ? "movie" : "",
                                    btnHighRes.classList.contains('active') ? "highRes" : "",
                                    btnEnhance.classList.contains('active') ? "enhance" : ""
                                ]
                            })
                        });

                        const data = await response.json();

                        if (data.status === 200 && data.image) {
                            const urlObj = new URL(data.image);
                            const imageId = urlObj.searchParams.get("id");

                            const myShowcaseUrl = `https://create.thena.workers.dev/publicShowcase?id=${imageId}`;

                            shareUrlDisplay.value = myShowcaseUrl;
                            copyShareLinkBtn.textContent = "Copy Link";
                            copyShareLinkBtn.disabled = false;
                            copyShareLinkBtn.style.cursor = "pointer";
                            
                            if (viewShareBtn && viewShareWrapper) {
                                viewShareBtn.href = myShowcaseUrl;
                                viewShareWrapper.classList.add('open');
                                setTimeout(() => {
                                    viewShareBtn.classList.add('visible');
                                }, 100);
                            }

                            if(typeof playSuccessSound === "function") {
                                playSuccessSound();
                                showNotification("Image uploaded successfully!", "success", base64Data);
                            }

                        } else {
                            console.error("Upload failed:", data);
                            shareUrlDisplay.value = "Upload failed. Please try again.";
                            copyShareLinkBtn.textContent = "Error";
                            if(typeof playErrorSound === "function") playErrorSound();

                            if (data.status == 401) {
                                showNotification("Invalid API Key provided.", "error");
                            } else if (data.status == 429) {
                                showNotification("Upload limit exceeded. Max 10 uploads per day.", "error");
                            } else if (data.status == 502) {
                                showNotification("Server error. Please try again later.", "error");
                            }
                        }
                    } else {
                        shareUrlDisplay.value = "Error: Image source is not base64.";
                        copyShareLinkBtn.textContent = "Error";
                        if(typeof playErrorSound === "function") playErrorSound();
                        showNotification("Image source is not base64.", "error");
                    }

                } catch (error) {
                    console.error("Upload error:", error);
                    shareUrlDisplay.value = "Upload failed. Please try again.";
                    copyShareLinkBtn.textContent = "Error";
                    if(typeof playErrorSound === "function") playErrorSound();
                    showNotification("Image upload failed.", "error");
                }
            });
        }

        if (closeShareBtn) {
            closeShareBtn.addEventListener('click', () => {
                shareModal.classList.remove('active');
            });
        }

        if (shareModal) {
            shareModal.addEventListener('click', (e) => {
                if (e.target === shareModal) {
                    shareModal.classList.remove('active');
                }
            });
        }

        if (copyShareLinkBtn) {
            copyShareLinkBtn.addEventListener('click', () => {
                if (copyShareLinkBtn.disabled) return;
                
                const urlToCopy = shareUrlDisplay.value;
                navigator.clipboard.writeText(urlToCopy).then(() => {
                    copyShareLinkBtn.textContent = "Copied!";
                    copyShareLinkBtn.style.background = "#00ff88";
                    copyShareLinkBtn.style.color = "#000";
                    
                    setTimeout(() => {
                        copyShareLinkBtn.textContent = "Copy Link";
                        copyShareLinkBtn.style.background = "#222";
                        copyShareLinkBtn.style.color = "#fff";
                    }, 2000);
                });
            });
        }

        const settingsBtn = document.getElementById('btn-open-settings');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsBtn = document.getElementById('btn-close-settings');
        const themeBtns = document.querySelectorAll('.theme-btn');
        const btnHardReset = document.getElementById('btn-hard-reset');
        const root = document.documentElement;

        settingsBtn.addEventListener('click', () => settingsModal.classList.add('active'));
        closeSettingsBtn.addEventListener('click', () => settingsModal.classList.remove('active'));
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) settingsModal.classList.remove('active');
        });


        const perfToggle = document.getElementById('perf-mode-toggle');
        function togglePerformanceMode(enable) {
            if (enable) {
                document.body.classList.add('performance-mode');
                if(perfToggle) perfToggle.checked = true;
                localStorage.setItem('thena-perf-mode', 'true');
            } else {
                document.body.classList.remove('performance-mode');
                if(perfToggle) perfToggle.checked = false;
                localStorage.setItem('thena-perf-mode', 'false');
            }
        }
        if (perfToggle) {
            perfToggle.addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                togglePerformanceMode(isChecked);
                if(typeof playInformationSound === "function") playInformationSound();
                const msg = isChecked ? "Performance Mode Enabled" : "Performance Mode Disabled";
                if(typeof showNotification === "function") showNotification(msg, "info");
            });
        }
        const savedPerfMode = localStorage.getItem('thena-perf-mode');
        if (savedPerfMode === 'true') {
            togglePerformanceMode(true);
        }

        function setTheme(color, rgb, gradient = null, notify = true) { 
            root.style.setProperty('--primary', color);
            root.style.setProperty('--primary-rgb', rgb);
            
            const themeBg = gradient ? gradient : color;
            root.style.setProperty('--theme-bg', themeBg);
            
            if (color == "#00ff88") {
                // green theme
                root.style.setProperty('--dot-filled-1', '#e6fff2');
                root.style.setProperty('--dot-filled-2', '#99ffcc'); 
                root.style.setProperty('--dot-filled-3', '#4dffaa'); 
                root.style.setProperty('--dot-filled-4', '#00ff88'); 
                root.style.setProperty('--dot-filled-5', '#00b35f');
                root.style.setProperty('--placeholderPulse-0-border', '#00ff881a');
                root.style.setProperty('--placeholderPulse-0-box-shadow', '#00ff880d');
                root.style.setProperty('--placeholderPulse-50-border', '#00ff8899');
                root.style.setProperty('--placeholderPulse-50-box-shadow', '#00ff8833');
                root.style.setProperty('--placeholderPulse-100-border', '#00ff881a');
                root.style.setProperty('--placeholderPulse-100-box-shadow', '#00ff880d');
            } else if (color == "#00ccff") {
                // blue theme
                root.style.setProperty('--dot-filled-1', '#e0e0e0');
                root.style.setProperty('--dot-filled-2', '#a2d2ff');
                root.style.setProperty('--dot-filled-3', '#60a5fa');
                root.style.setProperty('--dot-filled-4', '#3b82f6');
                root.style.setProperty('--dot-filled-5', '#1d4ed8');
                root.style.setProperty('--placeholderPulse-0-border', '#00ccff1a');
                root.style.setProperty('--placeholderPulse-0-box-shadow', '#00ccff0d');
                root.style.setProperty('--placeholderPulse-50-border', '#00ccff99');
                root.style.setProperty('--placeholderPulse-50-box-shadow', '#00ccff33');
                root.style.setProperty('--placeholderPulse-100-border', '#00ccff1a');
                root.style.setProperty('--placeholderPulse-100-box-shadow', '#00ccff0d');
            } else if (color == "#ff0088") {
                // pink/magenta theme
                root.style.setProperty('--dot-filled-1', '#ffe0f0'); 
                root.style.setProperty('--dot-filled-2', '#ff99cc'); 
                root.style.setProperty('--dot-filled-3', '#ff4da6'); 
                root.style.setProperty('--dot-filled-4', '#ff0088');
                root.style.setProperty('--dot-filled-5', '#cc006d'); 
                root.style.setProperty('--placeholderPulse-0-border', '#ff00881a');      
                root.style.setProperty('--placeholderPulse-0-box-shadow', '#ff00880d'); 
                root.style.setProperty('--placeholderPulse-50-border', '#ff008899');     
                root.style.setProperty('--placeholderPulse-50-box-shadow', '#ff008833'); 
                root.style.setProperty('--placeholderPulse-100-border', '#ff00881a');   
                root.style.setProperty('--placeholderPulse-100-box-shadow', '#ff00880d');
            } else if (color == "#ffaa00") {
                // orange/amber theme
                root.style.setProperty('--dot-filled-1', '#fff5e6');
                root.style.setProperty('--dot-filled-2', '#ffddb3'); 
                root.style.setProperty('--dot-filled-3', '#ffc466'); 
                root.style.setProperty('--dot-filled-4', '#ffaa00'); 
                root.style.setProperty('--dot-filled-5', '#cc8800');
                root.style.setProperty('--placeholderPulse-0-border', '#ffaa001a');      
                root.style.setProperty('--placeholderPulse-0-box-shadow', '#ffaa000d');  
                root.style.setProperty('--placeholderPulse-50-border', '#ffaa0099');     
                root.style.setProperty('--placeholderPulse-50-box-shadow', '#ffaa0033');
                root.style.setProperty('--placeholderPulse-100-border', '#ffaa001a');   
                root.style.setProperty('--placeholderPulse-100-box-shadow', '#ffaa000d');
            } else if (color == "#bd00ff") {
                // purple/violet theme
                root.style.setProperty('--dot-filled-1', '#f6e0ff'); 
                root.style.setProperty('--dot-filled-2', '#e299ff'); 
                root.style.setProperty('--dot-filled-3', '#d04dff'); 
                root.style.setProperty('--dot-filled-4', '#bd00ff'); 
                root.style.setProperty('--dot-filled-5', '#8a00ba');
                root.style.setProperty('--placeholderPulse-0-border', '#bd00ff1a');      
                root.style.setProperty('--placeholderPulse-0-box-shadow', '#bd00ff0d');  
                root.style.setProperty('--placeholderPulse-50-border', '#bd00ff99');    
                root.style.setProperty('--placeholderPulse-50-box-shadow', '#bd00ff33');
                root.style.setProperty('--placeholderPulse-100-border', '#bd00ff1a');   
                root.style.setProperty('--placeholderPulse-100-box-shadow', '#bd00ff0d');
            } else {
                // default blue theme
                root.style.setProperty('--dot-filled-1', '#e0e0e0');
                root.style.setProperty('--dot-filled-2', '#a2d2ff');
                root.style.setProperty('--dot-filled-3', '#60a5fa');
                root.style.setProperty('--dot-filled-4', '#3b82f6');
                root.style.setProperty('--dot-filled-5', '#1d4ed8');
                root.style.setProperty('--placeholderPulse-0-border', '#00ccff1a');
                root.style.setProperty('--placeholderPulse-0-box-shadow', '#00ccff0d');
                root.style.setProperty('--placeholderPulse-50-border', '#00ccff99');
                root.style.setProperty('--placeholderPulse-50-box-shadow', '#00ccff33');
                root.style.setProperty('--placeholderPulse-100-border', '#00ccff1a');
                root.style.setProperty('--placeholderPulse-100-box-shadow', '#00ccff0d');
            }

            const logoText = document.querySelector('.glitch-text');
            if (logoText) {
                if (gradient) {
                    logoText.classList.add('gradient-active');
                } else {
                    logoText.classList.remove('gradient-active');
                }
            }

            themeBtns.forEach(btn => {
                const btnGradient = btn.dataset.gradient || null;
                const btnColor = btn.dataset.color;
                
                if(gradient && btnGradient === gradient) {
                    btn.classList.add('active');
                    btn.style.borderColor = '#fff';
                } else if (!gradient && !btnGradient && btnColor === color) {
                    btn.classList.add('active');
                    btn.style.borderColor = '#fff';
                } else {
                    btn.classList.remove('active');
                    btn.style.borderColor = 'transparent';
                }
            });

            localStorage.setItem('thena-theme-color', color);
            localStorage.setItem('thena-theme-rgb', rgb);
            if (gradient) {
                localStorage.setItem('thena-theme-gradient', gradient);
            } else {
                localStorage.removeItem('thena-theme-gradient');
            }
            
            if (notify) {
                if(typeof playSuccessSound === "function") playModelSelectSound(true);
                showNotification("Theme updated successfully!", "info");
            }
        }

        themeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const color = btn.dataset.color;
                const rgb = btn.dataset.rgb;
                const gradient = btn.dataset.gradient || null;
                setTheme(color, rgb, gradient);
            });
        });

        const savedColor = localStorage.getItem('thena-theme-color');
        const savedRgb = localStorage.getItem('thena-theme-rgb');
        const savedGradient = localStorage.getItem('thena-theme-gradient');

        if (savedColor && savedRgb) {
            setTheme(savedColor, savedRgb, savedGradient, false);
        } else {
            setTheme('#00ccff', '0, 204, 255', null, false);
        }
        const hardResetModal = document.getElementById('hard-reset-modal');
        const btnCancelReset = document.getElementById('btn-cancel-reset');
        const btnConfirmReset = document.getElementById('btn-confirm-reset');

        btnHardReset.addEventListener('click', () => {
            if (typeof playDeleteAllWarningSound === "function") playDeleteAllWarningSound();
            
            hardResetModal.classList.add('active');
        });

        if (btnCancelReset) {
            btnCancelReset.addEventListener('click', () => {
                hardResetModal.classList.remove('active');
            });
        }

        if (hardResetModal) {
            hardResetModal.addEventListener('click', (e) => {
                if (e.target === hardResetModal) hardResetModal.classList.remove('active');
            });
        }

        if (btnConfirmReset) {
            btnConfirmReset.addEventListener('click', async () => {
                const originalText = btnConfirmReset.innerText;
                btnConfirmReset.innerText = "Resetting...";
                btnConfirmReset.disabled = true;

                try {
                    await dbHelper.clear();
                    localStorage.clear();
                    hardResetModal.classList.remove('active');
                    settingsModal.classList.remove('active');

                    if (typeof playSuccessSound === "function") playSuccessSound();
                    
                    showNotification("Application successfully reset. Page reloading...", "success");

                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);

                } catch (e) {
                    
                    if (typeof playErrorSound === "function") playErrorSound();
                    showNotification("Error occurred during reset: " + e.message, "error");
                    
                    btnConfirmReset.innerText = originalText;
                    btnConfirmReset.disabled = false;
                    hardResetModal.classList.remove('active');
                }
            });
        }


        const btnShowcase = document.getElementById('btn-showcase');
        const showcaseModal = document.getElementById('showcase-modal');
        const closeShowcaseBtn = document.getElementById('close-showcase');
        const showcaseGrid = document.getElementById('showcase-grid');
        const showcaseLoader = document.getElementById('showcase-loader');
        const showcaseSearch = document.getElementById('showcase-search');
        const showcaseFilterModel = document.getElementById('showcase-filter-model');
        const showcaseRefresh = document.getElementById('showcase-refresh');

        let showcaseData = [];
        let isShowcaseLoaded = false;

        if (btnShowcase) {
            btnShowcase.addEventListener('click', () => {
                showcaseModal.classList.add('active');
                document.body.classList.add('no-scroll');
                fetchShowcaseImages(); 
            });
        }

        if (closeShowcaseBtn) {
            closeShowcaseBtn.addEventListener('click', () => {
                showcaseModal.classList.remove('active');
                document.body.classList.remove('no-scroll');
            });
        }

        if (showcaseModal) {
            showcaseModal.addEventListener('click', (e) => {
                if (e.target === showcaseModal) {
                    showcaseModal.classList.remove('active');
                    document.body.classList.remove('no-scroll');
                }
            });
        }

        if (showcaseRefresh) {
            showcaseRefresh.addEventListener('click', () => {
                fetchShowcaseImages();
            });
        }

        async function fetchShowcaseImages() {
            showcaseGrid.innerHTML = '';
            showcaseLoader.classList.remove('hidden');
            
            try {
                const response = await fetch('https://create.thena.workers.dev/showcaseImages');
                if (!response.ok) {
                    playErrorSound();
                    showNotification("Failed to fetch showcase images. Please try again later.", "error");
                    return [];
                }
                
                const data = await response.json();
                
                showcaseData = data.map(item => {
                    const featuresObj = {};
                    if (Array.isArray(item.extra_features)) {
                        item.extra_features.forEach(f => {
                            if (f === 'fastMode') featuresObj.fast = true;
                            else if (f === 'denseMode') featuresObj.dense = true;
                            else featuresObj[f] = true;
                        });
                    }

                    return {
                        url: item.image,
                        prompt: item.prompt,
                        model: item.model,
                        size: item.ratio, 
                        timestamp: new Date().toISOString(),
                        moderation: item.moderation_level || 'high',
                        features: featuresObj
                    };
                });


                showcaseData.reverse();
                isShowcaseLoaded = true;
                populateShowcaseModelFilter();
                renderShowcase(showcaseData);

            } catch (error) {
                console.error('Showcase fetch error:', error);
                showcaseGrid.innerHTML = '<div class="empty-gallery">Failed to load showcase images. <br> Please try again later.</div>';
                if(typeof playErrorSound === "function") playErrorSound();
            } finally {
                showcaseLoader.classList.add('hidden');
            }
        }

        function populateShowcaseModelFilter() {
            const uniqueModels = [...new Set(showcaseData.map(item => item.model))];
            showcaseFilterModel.innerHTML = '<option value="">All Models</option>';
            uniqueModels.forEach(model => {
                const opt = document.createElement('option');
                opt.value = model;
                opt.textContent = model.replace(//g, 'i');
                showcaseFilterModel.appendChild(opt);
            });
        }

        function renderShowcase(items) {
            showcaseGrid.innerHTML = '';
            
            if (items.length === 0) {
                showcaseGrid.innerHTML = '<div class="empty-gallery">No images found matching criteria.</div>';
                return;
            }

            const html = items.map((item, index) => {
                let spanClass = '';
                
                if (item.size) {
                    const [width, height] = item.size.split('x').map(Number);
                    if (width && height) {
                        const ratio = width / height;
                        if (ratio >= 1.7) spanClass = 'wide';
                        else if (ratio <= 0.6) spanClass = 'tall';
                    }
                }

                if (item.moderation === 'medium' || item.moderation === 'low') {
                    spanClass += ' sensitive-medium';
                }

                const itemData = encodeURIComponent(JSON.stringify(item));

                return `
                <div class="gallery-item ${spanClass}" style="animation-delay: ${index * 50}ms" data-item="${itemData}">
                    <img src="${item.url}" loading="lazy" alt="Showcase Image">
                    
                    <div class="gallery-item-info" style="justify-content: center;">
                        <div class="info-meta" style="font-size: 0.9rem; font-weight: 500;">${item.model.replace(/i/g, 'I')}</div>
                    </div>
                </div>`;
            }).join('');

            showcaseGrid.insertAdjacentHTML('beforeend', html);
            
            requestAnimationFrame(() => {
                const newItems = showcaseGrid.querySelectorAll('.gallery-item');
                newItems.forEach(item => item.classList.add('show'));
            });
        }

        function applyShowcaseFilters() {
            const search = showcaseSearch.value.toLowerCase();
            const model = showcaseFilterModel.value;

            const filtered = showcaseData.filter(item => {
                const matchesSearch = item.prompt.toLowerCase().includes(search);
                const matchesModel = model === '' || item.model === model;
                return matchesSearch && matchesModel;
            });

            renderShowcase(filtered);
        }

        if (showcaseSearch) {
            showcaseSearch.addEventListener('input', () => {
                applyShowcaseFilters();
            });
        }

        if (showcaseFilterModel) {
            showcaseFilterModel.addEventListener('change', () => {
                applyShowcaseFilters();
            });
        }

        if (showcaseGrid) {
            showcaseGrid.addEventListener('click', (e) => {
                const item = e.target.closest('.gallery-item');
                if (item && !e.target.closest('.gallery-copy-btn')) {
                    try {
                        const data = JSON.parse(decodeURIComponent(item.dataset.item));
                        data.isShowcase = true; 
                        if(typeof openLightbox === "function") openLightbox(data);
                    } catch (err) {
                        console.error("Error parsing item data", err);
                    }
                }
            });
        }

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const featModal = document.getElementById('feature-info-modal');
                    if (featModal && featModal.classList.contains('active')) {
                        featModal.classList.remove('active');
                    }


                    const lightbox = document.getElementById('lightbox');
                    const lightboxImg = document.getElementById('lightbox-img');
                    if (lightbox && lightbox.classList.contains('active')) {
                        lightbox.classList.remove('active');
                        setTimeout(() => {
                            if (lightboxImg) lightboxImg.src = '';
                        }, 300);
                    }

                    const galleryModal = document.getElementById('gallery-modal');
                    if (galleryModal && galleryModal.classList.contains('active')) {
                        galleryModal.classList.remove('active');
                        document.body.classList.remove('no-scroll');
                    }

                    const openOwner = document.getElementById('redirect-modal');
                    if (openOwner && openOwner.classList.contains('active')) {
                        openOwner.classList.remove('active');
                    }


                    const settingsModal = document.getElementById('settings-modal');
                    if (settingsModal && settingsModal.classList.contains('active')) {
                        settingsModal.classList.remove('active');
                    }

                    const showcaseModal = document.getElementById('showcase-modal');
                    if (showcaseModal && showcaseModal.classList.contains('active')) {
                        showcaseModal.classList.remove('active');
                        document.body.classList.remove('no-scroll');
                    }

                    const shareModal = document.getElementById('share-modal');
                    if (shareModal && shareModal.classList.contains('active')) {
                        shareModal.classList.remove('active');
                    }
                }
            });



            const img2PromptBtn = document.getElementById('img2prompt-btn');
            const img2PromptModal = document.getElementById('img2prompt-modal');
            const btnImg2PromptCancel = document.getElementById('btn-img2prompt-cancel');
            const btnImg2PromptGenerate = document.getElementById('btn-img2prompt-generate');
            const uploadArea = document.getElementById('img-upload-area');
            const fileInput = document.getElementById('img-file-input');
            const previewImg = document.getElementById('preview-img');
            const uploadPlaceholder = document.getElementById('upload-placeholder');
            const clearImgBtn = document.getElementById('clear-img-btn');

            let currentBase64Image = null;

            img2PromptBtn.addEventListener('click', () => {
                img2PromptModal.classList.add('active');
                if(typeof playInformationSound === "function") playInformationSound();
            });

            btnImg2PromptCancel.addEventListener('click', () => {
                if (btnImg2PromptGenerate.classList.contains('loading')) return; 
                closeImg2PromptModal();
            });

            img2PromptModal.addEventListener('click', (e) => {
                if (btnImg2PromptGenerate.classList.contains('loading')) return;
                if (e.target === img2PromptModal) closeImg2PromptModal();
            });

            function closeImg2PromptModal() {
                img2PromptModal.classList.remove('active');
                clearImageSelection();
            }

            uploadArea.addEventListener('click', (e) => {
                if(e.target !== clearImgBtn) {
                    fileInput.click();
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                handleImageFile(file);
            });

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                handleImageFile(file);
            });

            document.addEventListener('paste', (e) => {
                if (!img2PromptModal.classList.contains('active')) return;
                
                const items = (e.clipboardData || e.originalEvent.clipboardData).items;
                for (let index in items) {
                    const item = items[index];
                    if (item.kind === 'file' && item.type.startsWith('image/')) {
                        const blob = item.getAsFile();
                        handleImageFile(blob);
                        break;
                    }
                }
            });

            clearImgBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                clearImageSelection();
            });

            function clearImageSelection() {
                currentBase64Image = null;
                previewImg.src = '';
                previewImg.classList.add('hidden');
                clearImgBtn.classList.add('hidden');
                uploadPlaceholder.classList.remove('hidden');
                fileInput.value = '';
                btnImg2PromptGenerate.disabled = true;
            }

            function handleImageFile(file) {
                if (!file || !file.type.startsWith('image/')) {
                    if(typeof showNotification === "function") showNotification("Please select a valid image file.", "error");
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    if(typeof showNotification === "function") showNotification("Image is too large (Max 5MB).", "error");
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target.result;
                    currentBase64Image = base64;
                    
                    previewImg.src = base64;
                    previewImg.classList.remove('hidden');
                    clearImgBtn.classList.remove('hidden');
                    uploadPlaceholder.classList.add('hidden');
                    btnImg2PromptGenerate.disabled = false;
                    
                    if(typeof playSuccessSound === "function") playModelSelectSound(true);
                };
                reader.readAsDataURL(file);
            }

            btnImg2PromptGenerate.addEventListener('click', async () => {
                const apiKey = document.getElementById('api-key').value.trim();
                
                if (!apiKey) {
                    if(typeof showNotification === "function") showNotification("Please enter your API Key first.", "error");
                    if(typeof playErrorSound === "function") playErrorSound();
                    return;
                }

                if (!currentBase64Image) return;

                const originalBtnContent = btnImg2PromptGenerate.innerHTML;
                btnImg2PromptGenerate.innerHTML = `<span>Analyzing...</span><svg class="sparkle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>`;
                var clipnotif = showNotification("Generating prompt from image. This may take a moment...", "loading");
                playInformationSound();
                btnImg2PromptGenerate.classList.add('loading');
                btnImg2PromptGenerate.disabled = true;

                btnImg2PromptCancel.disabled = true;
                btnImg2PromptCancel.style.opacity = "0.5";
                btnImg2PromptCancel.style.cursor = "not-allowed";

                try {                    
                    const img = new Image();
                    img.src = currentBase64Image;
                    await new Promise(resolve => img.onload = resolve);
                    const scaleFactor = 0.6; 
                    const newWidth = Math.floor(img.width * scaleFactor);
                    const newHeight = Math.floor(img.height * scaleFactor);

                    const canvas = document.createElement('canvas');
                    canvas.width = newWidth;
                    canvas.height = newHeight;
                    const ctx = canvas.getContext('2d');
                    
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    
                    ctx.drawImage(img, 0, 0, newWidth, newHeight);

                    const resizedDataUrl = canvas.toDataURL('image/jpeg', 0.9);
                    
                    const rawBase64 = resizedDataUrl.split(',')[1];
                    

                    const response = await fetch('https://create.thena.workers.dev/clipPrior', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            apikey: apiKey,
                            image: rawBase64
                        })
                    });

                    const data = await response.json();
                    if (clipnotif) clipnotif();
                    
                    if (data.status === 200 && data.content) {
                        if(typeof playSuccessSound === "function") playSuccessSound();
                        closeImg2PromptModal();
                        
                        const incomingPrompt = data.content.prompt || ""; 
                        const promptInput = document.getElementById('prompt');
                        if (typeof typeWriterEffect === "function") {
                            typeWriterEffect(incomingPrompt, promptInput);
                        } else {
                            promptInput.value = incomingPrompt;
                            if(typeof autoResize === "function") autoResize(promptInput);
                        }
                        
                        if (data.content.model) {
                            const targetModelName = data.content.model.trim();
                            const modelCards = document.querySelectorAll('.model-card');
                            
                            modelCards.forEach(card => {
                                const nameEl = card.querySelector('.model-name');
                                if (nameEl && nameEl.innerText.trim().toLowerCase() === targetModelName.toLowerCase()) {
                                    if (!card.classList.contains('active')) {
                                        card.click();
                                        if(typeof showNotification === "function") {
                                            setTimeout(() => {
                                                showNotification(`Model switched to: ${targetModelName}`, "info");
                                            }, 800); 
                                        }
                                    }
                                }
                            });
                        }

                        if (data.content.aspect_ratio) {
                            const targetRatio = data.content.aspect_ratio.trim();
                            const ratioBtn = document.querySelector(`.aspect-btn[data-ratio="${targetRatio}"]`);
                            if (ratioBtn) {
                                if (!ratioBtn.classList.contains('active')) {
                                    ratioBtn.click();
                                }
                            }
                        }

                        allExtraBtns.forEach(b => b.classList.remove('active'));

                        if (Array.isArray(data.content.extra_features)) {
                            const features = data.content.extra_features;
                            
                            if (features.includes('fast') && btnFast && !btnFast.disabled) btnFast.classList.add('active');
                            if (features.includes('creative') && btnCreative) btnCreative.classList.add('active');
                            
                            if (features.includes('dense') && btnDense) {
                                btnDense.classList.add('active');
                                if(btnCreative) btnCreative.classList.remove('active');
                            }
                            if (features.includes('movie') && btnMovie && !btnMovie.disabled) btnMovie.classList.add('active');
                            if (features.includes('highRes') && btnHighRes) btnHighRes.classList.add('active');
                        }
                        
                        checkFormReady();
                        if(typeof showNotification === "function") showNotification("Prompt and settings applied successfully!", "success");

                    } else {
                        showNotification("Failed to generate prompt. Please try different image.", "error");
                        if(typeof playErrorSound === "function") playErrorSound();
                    }

                } catch (error) {
                    console.error(error);
                    if(typeof playErrorSound === "function") playErrorSound();
                    showNotification("Failed to generate prompt. Please try different image.", "error");
                } finally {
                    btnImg2PromptGenerate.innerHTML = originalBtnContent;
                    btnImg2PromptGenerate.classList.remove('loading');
                    btnImg2PromptGenerate.disabled = false;
                    btnImg2PromptCancel.disabled = false;
                    btnImg2PromptCancel.style.opacity = "";
                    btnImg2PromptCancel.style.cursor = "";
                }
            });
        </script>
        <div id="feature-info-modal" class="feature-modal">
            <div class="feature-info-card">
                <button id="close-feat-modal" style="position:absolute; right:15px; top:15px; background:none; border:none; color:#666; cursor:pointer; font-size:20px;">&times;</button>
                <div class="feat-title" id="feat-modal-title"></div>
                <div class="feat-desc" id="feat-modal-desc"></div>
                <div class="metric-row">
                    <span>Intelligence</span>
                    <div class="metric-dots" id="metric-intelligence"></div>
                </div>
                <div class="metric-row">
                    <span>Quality</span>
                    <div class="metric-dots" id="metric-quality"></div>
                </div>
                <div class="metric-row">
                    <span>Speed</span>
                    <div class="metric-dots" id="metric-speed"></div>
                </div>
            </div>
        </div>
    </body>
</html>